"use strict"; if (typeof __JSWRAPPER === 'undefined' || (!__JSWRAPPER.initialized())) {
     if ((typeof ServiceWorkerContainer !== 'undefined' && self instanceof ServiceWorkerContainer) || (typeof WorkerGlobalScope !== 'undefined' && self instanceof WorkerGlobalScope)) {
         importScripts('https://mcas-proxyweb.mcas.ms/js-bootstrap.js?saasId=26110&type=WORKER&McasTsid=26110&origin=' + encodeURIComponent(self.origin ? self.origin : location.origin));
     } else {
         /* eslint-disable */
         eval(function () {
             var x = (typeof __caac__ !== "undefined" && typeof __caac__.xhr !== "undefined") ? new __caac__.xhr() : new XMLHttpRequest();
             x.open = (typeof __caac__ !== "undefined" && typeof __caac__.xhro !== "undefined") ? __caac__.xhro : x.open;
             x.send = (typeof __caac__ !== "undefined" && typeof __caac__.xhrs !== "undefined") ? __caac__.xhrs : x.send;
             x.open('GET', 'https://mcas-proxyweb.mcas.ms/js-bootstrap.js?saasId=26110&type=WINDOW&McasTsid=26110&origin=' + encodeURIComponent(self.origin ? self.origin : location.origin), false);
             x.withCredentials = true;
             x.send();
             return x.responseText;
         }());
         /* eslint-enable */
     }
}define("Repos/Editor",["require","exports","react","VSS/Core/Observable","VSSUI/Checkbox","VSSUI/Panel","VSS/Platform/Context","Tfs/Platform/Page","VSS/Platform/FPS","VSS/Platform/Location","Repos/Common/Util/Commit","VSS/Core/Util/String","VSS/Features/PlatformUI/FPSLink","VSS/Platform/Layout","VSSUI/Icon","VSSUI/Observer","VSSUI/ProgressBar","VSSUI/TooltipEx","VSSUI/Utilities/ScreenSize","Repos/Common/Util/BidiDetector","VSS/Features/Monaco/Components/Editor","VSS/Platform/Components/Format","VSSUI/Link","VSSUI/MessageBar","VSS/Core/TimerManagement","VSS/Platform/Util/Storage","VSSUI/Splitter","VSSUI/MessageCard","Repos/ChangesCommon/ChangesContext","VSS/Features/Monaco/Components/DiffEditor","VSS/Platform/Components/ErrorBoundary"],(function(e,t,i,n,o,r,s,a,l,d,c,f,h,m,p,g,u,C,b,E,v,S,L,D,w,x,N,P,M,U,y){var O,R,I,T,V,F,k,B,W,A,H;O=t.Resources={},t.Resources.BidiDocsLink="https://aka.ms/AAeunxo",t.Resources.BidiWarningLinkMessage="Learn more about bidirectional Unicode characters",t.Resources.BidiWarningMessage="This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. {0}",t.Resources.BinaryFileMessageFormat='This file contains non-printable characters and no other viewer was found for file extension "{0}".',t.Resources.BinaryDifferentMessageFormat="The two versions of the file are different.",t.Resources.BinaryIdenticalMessageFormat="The two versions of the file are the same.",t.Resources.Cancel="Cancel",t.Resources.CodeSearchToDefinitionLabel="Search for definition",t.Resources.CodeSearchToReferenceLabel="Search for references",t.Resources.CodeSearchToTextLabel="Search for text",t.Resources.ContentTruncated="The file contents were truncated since they exceeded the maximum file content length. {0} the full file contents.",t.Resources.DiffContentTruncated="The file contents were truncated since they exceeded the maximum file content length. This may result in an inconsistent diff near the bottom of the file. Browse to the individual files to download full content.",t.Resources.Download="Download",t.Resources.DownloadOriginal="Download original file",t.Resources.DownloadModified="Download modified file",t.Resources.NextDiff="Go to Next Difference In All Changes",t.Resources.PreferenceWhitespace="Show and diff white space",t.Resources.PreferenceWordWrap="Enable word wrap",t.Resources.PreferenceFolding="Enable code folding",t.Resources.PreferenceMinimap="Show minimap",t.Resources.PreviousDiff="Go to Previous Difference In All Changes",t.Resources.PriorBlame="View blame prior to this commit",t.Resources.Save="Save",t.Resources.UserPreferencesPanelTitle="Editor preferences",t.Resources.UserPreferences="User preferences",function(e){R=t[e]={};class s extends i.Component{constructor(e){super(e);const t=e.initialPreferences;this.folding=new n.ObservableValue(!!t.foldingEnabled),this.minimap=new n.ObservableValue(!!t.minimapEnabled),this.whitespace=new n.ObservableValue(!!t.whiteSpaceEnabled),this.wordWrap=new n.ObservableValue(!!t.wordWrapEnabled)}render(){return i.createElement(r.Panel,{defaultActiveElement:".bolt-checkbox",onDismiss:()=>{this.props.onDismiss()},titleProps:{text:O.UserPreferencesPanelTitle},footerButtonProps:[{onClick:()=>{this.props.onDismiss()},text:O.Cancel},{onClick:()=>{const e=Object.assign(Object.assign({},this.props.initialPreferences),{foldingEnabled:this.folding.value,minimapEnabled:this.minimap.value,whiteSpaceEnabled:this.whitespace.value,wordWrapEnabled:this.wordWrap.value});this.props.onDismiss(e)},primary:!0,text:O.Save}]},i.createElement("div",{className:"rhythm-vertical-8 flex-column"},i.createElement(o.Checkbox,{onChange:(e,t)=>this.whitespace.value=t,checked:this.whitespace,label:O.PreferenceWhitespace}),i.createElement(o.Checkbox,{onChange:(e,t)=>this.wordWrap.value=t,checked:this.wordWrap,label:O.PreferenceWordWrap}),!this.props.isDiffEditor&&i.createElement(i.Fragment,null,i.createElement(o.Checkbox,{onChange:(e,t)=>this.folding.value=t,checked:this.folding,label:O.PreferenceFolding}),i.createElement(o.Checkbox,{onChange:(e,t)=>this.minimap.value=t,checked:this.minimap,label:O.PreferenceMinimap}))))}}t[e].EditorPreferencesPanel=s}("ComponentsEditorPreferencesPanel"),function(e){I=t[e]={};class o extends s.VssService{_serviceStart(e){super._serviceStart(e);const t=e.getService("IVCViewModelDataProviderService");this.preferences=new n.ObservableValue(t.getUserPreferences())}getEditorOptions(e,t,i,n){const o=this.preferences.value.editorPreferences,r={folding:o.foldingEnabled&&!t&&!i,glyphMargin:i,lineDecorationsWidth:i?20:void 0,lineNumbers:n?"off":"on",minimap:{enabled:o.minimapEnabled},renderWhitespace:o.whiteSpaceEnabled?"all":"none",ignoreTrimWhitespace:!o.whiteSpaceEnabled,readOnly:!e,wordWrap:o.wordWrapEnabled&&!t?"on":"off"};return t&&(r.find={addExtraSpaceOnTop:!1}),r}getPreferences(){return this.preferences}getAction(e){return{id:"tfs-user-preferences",label:O.UserPreferences,contextMenuGroupId:"99_preferences",run:()=>this.showPreferences(e)}}showPreferences(e){this.pageContext.getService("IVssLayoutManager").renderCallout((t=>{const n=this.pageContext.getService("IVCViewModelDataProviderService"),o=n.getUserPreferences().editorPreferences;return i.createElement(R.EditorPreferencesPanel,{initialPreferences:o,isDiffEditor:e,onDismiss:e=>{if(t(),e){const t=Object.assign(Object.assign({},n.getUserPreferences()),{editorPreferences:e});n.setUserPreferences(t),this.preferences.value=t}}})}))}}t[e].getEditorUserPreferencesService=function(e){return e.getService("IEditorUserPreferencesService")},s.Services.add("IEditorUserPreferencesService",{serviceFactory:o})}("UserPreferencesService"),function(e){T=t[e]={};const i="ms.vss-search-web.project-route",n="code",o="}",r="72802cd9-9396-4276-9059-8c5e227cd8be",s="ada3e19f-82ea-47a9-9585-e4ac3088b9e1",c="08350060-51be-4155-9297-58633a8200e1";function f(e,t,f,m){return{id:t,label:f,contextMenuGroupId:m,run:f=>function(e,t,f){let m="";const p=t.getSelection(),g=t.getModel(),u=Math.max(p.startLineNumber,p.endLineNumber),C=Math.min(p.startLineNumber,p.endLineNumber),b=Math.min(p.startColumn,p.endColumn),E=Math.max(p.startColumn,p.endColumn);if(u>C||E>b)m=g.getValueInRange(p);else{const e=g.getWordAtPosition({lineNumber:C,column:b});e&&(m=e.word)}m=m.trim(),""!==m&&(function(e,t){let i="";switch(t){case r:i="TermSearchContextMenuItemAction";break;case s:i="DefinitionSearchContextMenuItemAction";break;case c:i="ReferencesSearchContextMenuItemAction"}e.getService("IVssTelemetryService").publishEvent("webaccess.search","CodeSearchPortal",{actionName:i})}(e,f),function(e,t,r){const s=(0,a.getTFSPageData)(e),c=s&&s.project&&s.project.name;let f=c?"ProjectFilters{"+c+o:"";const m=e.getService("IProjectRepositoryInformationService").getData();if(m){const e=m.defaultRepoIsGit?m.defaultGitRepoName:`$/${c}`;f=f.concat("RepositoryFilters{"+e+o)}const p={type:n,text:h(t,r),filters:f,project:c||""},g=(0,d.routeUrl)(e,i,p);(0,l.onClickFPS)(e,g,!0)}(e,m,f))}(e,f,t)}}function h(e,t){let i="";switch(e.trim().split(" ").length>1&&(e='"'.concat(e).concat('"')),t){case r:i=e;break;case s:i="def:".concat(e);break;case c:i="ref:".concat(e)}return i}t[e].getSearchContextMenuItems=function(e){const t=[];return e.getService("IVssContributionService").getContribution("ms.vss-code-web.versioncontrol-project-search-provider")&&(t.push(f(e,r,O.CodeSearchToTextLabel,"1_codesearch/1_termsearch")),t.push(f(e,s,O.CodeSearchToDefinitionLabel,"1_codesearch/2_definitionsearch")),t.push(f(e,c,O.CodeSearchToReferenceLabel,"1_codesearch/3_referencesearch"))),t}}("SearchContextMenuItemExtension"),function(e){V=t[e]={};class o extends m.VssComponent{constructor(e,t){super(e,t),this.selectedChangeId=new n.ObservableValue(""),this.onSelectedLineChanged=e=>{let t="";for(const i of this.props.annotationBlocks.value)if(e>=i.startLine&&e<=i.startLine+i.lineCount-1){i.historyEntry&&(t=i.historyEntry.shortId);break}this.selectedChangeId.value!==t&&(this.selectedChangeId.value=t)},this.onScroll=e=>{this.props.onScroll(e.target.scrollTop)},this.renderBlock=e=>{const t=`annotation-block-${e.startLine}`;return i.createElement(r,{blockDetails:e,key:t,lineHeight:this.props.lineHeight,selectedChangeId:this.selectedChangeId,selectedLineNumber:this.props.selectedLine})},this.observe([{propertyName:"selectedLine",observer:this.onSelectedLineChanged}])}render(){return i.createElement(g.Observer,{blocks:this.props.annotationBlocks,ready:this.props.annotationBlocks.ready},(e=>i.createElement("div",{className:"flex-column relative v-scroll-auto custom-scrollbar custom-scrollbar-hidden",style:{height:this.props.height},ref:e=>{this.containerRef=e,e&&this.props.initialScrollPosition&&e.scrollTo({top:this.props.initialScrollPosition.scrollTop,left:this.props.initialScrollPosition.scrollLeft})},onScroll:this.onScroll},!e.ready&&i.createElement(u.IndeterminateProgressBar,{className:"repos-annotations-loading-progress",loading:!0}),i.createElement("div",{className:"flex-column"},e.blocks.map(this.renderBlock)))))}getScrollTop(){var e;return(null===(e=this.containerRef)||void 0===e?void 0:e.scrollTop)||0}scrollTo(e){this.containerRef&&(this.containerRef.scrollTop=e)}}t[e].AnnotationList=o;class r extends m.VssComponent{constructor(e){super(e),this.isSelectedLine=new n.ObservableValue(!1),this.isSelectedChange=new n.ObservableValue(!1),this.onSelectedChangeChanged=e=>{const t=this.props.blockDetails,i=t.historyEntry&&t.historyEntry.shortId===e;!!i!==this.isSelectedChange.value&&(this.isSelectedChange.value=!!i)},this.onSelectedLineChanged=e=>{const t=this.props.blockDetails,i=e>=t.startLine&&e<=t.startLine+t.lineCount-1;!!i!==this.isSelectedLine.value&&(this.isSelectedLine.value=!!i)},this.observe([{propertyName:"selectedChangeId",observer:this.onSelectedChangeChanged},{propertyName:"selectedLineNumber",observer:this.onSelectedLineChanged}]),this.onSelectedChangeChanged(e.selectedChangeId.value),this.onSelectedLineChanged(e.selectedLineNumber.value)}render(){const{historyEntry:e,lineCount:t}=this.props.blockDetails,n=t*this.props.lineHeight+"px";return i.createElement("div",{className:"repos-annotation-block padding-left-8 padding-right-4 body-s scroll-hidden",style:{height:n,minHeight:n}},i.createElement("div",{className:"repos-annotation-details flex-row flex-center"},i.createElement(b.ScreenSizeConditional,{condition:e=>e<=0},e&&e.authorName?i.createElement(h.FPSLink,{className:"repos-annotation-mobile repos-annotation-cell flex-row flex-wrap",href:e.changeUrl},i.createElement("span",{className:"margin-right-4"},e.authorName),i.createElement("span",null,(0,f.dateToString)(e.date,"date"))):null),i.createElement(b.ScreenSizeConditional,{condition:e=>e>0},i.createElement(i.Fragment,null,i.createElement(g.Observer,{isSelectedLine:this.isSelectedLine,isSelectedChange:this.isSelectedChange},(e=>e.isSelectedLine?i.createElement("div",{className:"repos-annotation-line-selected repos-annotation-cell"}):e.isSelectedChange?i.createElement("div",{className:"repos-annotation-commit-selected repos-annotation-cell"}):null)),e&&i.createElement(h.FPSLink,{className:"repos-annotation-version repos-annotation-cell margin-right-4 monospaced-text white-space-nowrap",href:e.changeUrl,tooltipProps:{text:(0,c.getShortCommitComment)(e.comment||"")}},e.shortId)||i.createElement("div",{className:"repos-annotation-version repos-annotation-cell margin-right-4 invisible"}),e&&e.annotatePreviousUrl&&i.createElement(h.FPSLink,{ariaLabel:O.PriorBlame,className:"repos-annotation-prior repos-annotation-cell white-space-nowrap",href:e.annotatePreviousUrl,tooltipProps:{text:O.PriorBlame}},i.createElement(p.Icon,{iconName:"Rewind"}))||i.createElement("div",{className:"repos-annotation-prior repos-annotation-cell invisible"}),e&&e.authorName&&i.createElement(C.Tooltip,{text:e.authorEmail?`${e.authorName} <${e.authorEmail}>`:e.authorName},i.createElement("div",{className:"repos-annotation-author repos-annotation-cell flex-grow text-ellipsis"},e.authorName))||i.createElement("div",{className:"repos-annotation-author repos-annotation-cell invisible"}),e&&e.date&&i.createElement(C.Tooltip,{text:(0,f.dateToString)(e.date,"dateTime")},i.createElement("div",{className:"repos-annotation-date repos-annotation-cell white-space-nowrap"},(0,f.dateToString)(e.date,"date")))||i.createElement("div",{className:"repos-annotation-date repos-annotation-cell invisible"})))))}}}("ComponentsAnnotationList"),F=t.ComponentsShortcuts={},t.ComponentsShortcuts.unregisterDefaultKeyBindings=function(e,t){try{const i=e._standaloneKeybindingService,n=i._getResolver()._defaultKeybindings.filter((e=>e.keypressParts[0]==t));for(const e of n)i.addDynamicKeybinding(`-${e.command}`,void 0,(()=>{}))}catch(e){console.warn(e)}},function(e){k=t[e]={};class o extends m.VssComponent{constructor(e,t){super(e,t),this.truncatedMessageDismissed=new n.ObservableValue(!1),this.bidiMessageDismissed=new n.ObservableValue(!1),this.onEditorRef=e=>{this.editorRef=e,this.props.editorRef&&this.props.editorRef(e),(0,F.unregisterDefaultKeyBindings)(this.editorRef,"ctrl+K"),this.props.onLoaded&&this.props.onLoaded(),this.props.initialSelectedText?(this.editorRef.setSelection(this.props.initialSelectedText),this.editorRef.revealRangeInCenterIfOutsideViewport(this.props.initialSelectedText)):this.props.initialScrollPosition&&this.editorRef.setScrollPosition(this.props.initialScrollPosition),this.props.editable&&n.ObservableLike.getValue(this.props.editable)&&this.editorRef.focus(),this.props.onScrollChanged&&this.editorRef.onDidScrollChange((e=>{e.scrollTopChanged&&this.props.onScrollChanged({scrollLeft:e.scrollLeft,scrollTop:e.scrollTop})}))},this.delayedHighlighting=(e,t)=>{const i=`${t}-highlight`;let n=[];const o=new Map;e.forEach((e=>{const t=o.get(e.startLineNumber)||[];t.push(new monaco.Range(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn)),o.set(e.startLineNumber,t)}));const r=e=>{n=e?this.editorRef.deltaDecorations(n,[{range:e,options:{className:i}}]):this.editorRef.deltaDecorations(n,[])};this.editorRef.onMouseMove((e=>{var t;const i=e.target.range;if(i){const e=null!==(t=o.get(i.startLineNumber))&&void 0!==t?t:[];for(const t of e)if(t.intersectRanges(i))return r(t)}r(null)})),this.editorRef.onMouseLeave((e=>r(null))),this.editorRef.onMouseDown((e=>r(null))),this.editorRef.onMouseUp((e=>r(null)))},this.onContentUpdated=e=>{if(this.props.onContentChanged){const t=e.getModel();this.props.onContentChanged(t.getValue())}},this.editable=n.ObservableLike.getValue(e.editable||!1);(0,I.getEditorUserPreferencesService)(t.pageContext).getPreferences().subscribe((()=>this.editorRef&&this.editorRef.updateOptions(this.getEditorOptions())))}componentDidMount(){super.componentDidMount(),this.observe([{propertyName:"editable",observer:e=>{this.editable!==e&&(this.editable=e,this.editorRef&&(this.editorRef.updateOptions({readOnly:!e}),e&&this.editorRef.focus()))}},{propertyName:"scrollToLine",observer:e=>{const t={column:0,lineNumber:e||1};this.editorRef.setPosition(t),this.editorRef.revealPositionInCenter(t)}}])}render(){const{forceSingleLineMode:e,showMarginForIcons:t}=this.props;let n=null;this.props.content.contentTruncated&&(n=i.createElement(g.Observer,{dismissed:this.truncatedMessageDismissed},(e=>!e.dismissed&&i.createElement(D.MessageBar,{className:"flex-noshrink",onDismiss:()=>this.truncatedMessageDismissed.value=!0,severity:"Warning"},i.createElement(S.FormatComponent,{format:O.ContentTruncated},i.createElement(L.Link,{href:this.props.getDownloadUrl&&this.props.getDownloadUrl(!0)},O.Download))))));let o=null;(0,E.detectBidiCharacterInLine)(this.props.content.content)&&(o=i.createElement(g.Observer,{dismissed:this.bidiMessageDismissed},(e=>!e.dismissed&&i.createElement(D.MessageBar,{className:"flex-noshrink",severity:"Warning",onDismiss:()=>this.bidiMessageDismissed.value=!0},i.createElement(S.FormatComponent,{format:O.BidiWarningMessage},i.createElement(L.Link,{href:O.BidiDocsLink,target:"_blank"},O.BidiWarningLinkMessage))))));const r=i.createElement(v.Editor,{actions:this.getEditorActions(),className:(0,m.css)("repos-file-editor flex-grow scroll-hidden",t&&"repos-file-editor-with-margin-icon"),content:{content:this.props.content.content,contentUri:this.props.content.resourceUri},editorOptions:this.getEditorOptions(),editorRef:this.onEditorRef,fileExtension:this.props.content.metadata.extension,fileUrl:this.props.content.resourceUri,getSelectedTextLink:this.props.getCodeSelectionLinkUrl,onContentUpdated:this.onContentUpdated,widgets:this.props.editorWidgets,delayedHighlighting:this.delayedHighlighting});return n||o?i.createElement("div",{className:"flex-column flex-grow"},n,o,i.createElement("div",{className:"flex-row flex-grow"},r)):r}getEditorActions(){const e=(0,T.getSearchContextMenuItems)(this.context.pageContext);return e.push((0,I.getEditorUserPreferencesService)(this.context.pageContext).getAction(!1)),e}getEditorOptions(){const{forceSingleLineMode:e,showMarginForIcons:t}=this.props;return(0,I.getEditorUserPreferencesService)(this.context.pageContext).getEditorOptions(this.editable,e,t)}}t[e].CodeEditor=o}("ComponentsCodeEditor"),function(e){B=t[e]={};const o="Repos.AnnotatedCodeEditor.SplitterWidth";class r extends m.VssComponent{constructor(e){super(e),this.editor=new n.ObservableValue(null),this.annotationsList=null,this.selectedLine=new n.ObservableValue(1),this.annotationPaneWidth=new n.ObservableValue(0),this.editorScrollChanged=e=>{this.annotationsList&&Math.abs(this.annotationsList.getScrollTop()-e.scrollTop)>=1&&this.annotationsList.scrollTo(e.scrollTop)},this.annotationsScrollChanged=e=>{const t=this.editor.value;t&&Math.abs(t.getScrollTop()-e)>=1&&t.setScrollTop(e)},this.onEditorChanged=e=>{e&&(this.setState({editorLineHeight:e.getOption(monaco.editor.EditorOption.lineHeight)}),e.onDidScrollChange(this.editorScrollChanged),e.onDidChangeCursorPosition(this.editorCursorPositionChanged))},this.editorCursorPositionChanged=e=>{this.selectedLine.value!==e.position.lineNumber&&(this.selectedLine.value=e.position.lineNumber)},this.onRenderFarElement=()=>i.createElement(k.CodeEditor,{content:this.props.content,editorRef:e=>{this.editor.value!==e&&(this.editor.value=e)},forceSingleLineMode:!0,getDownloadUrl:this.props.getDownloadUrl,initialScrollPosition:this.props.initialScrollPosition,onLoaded:this.props.onLoaded,onScrollChanged:this.props.onScrollChanged,scrollToLine:this.props.scrollToLine}),this.onRenderNearElement=()=>i.createElement(g.Observer,{editor:this.editor},(e=>{if(e.editor){const t=e.editor.getDomNode().clientHeight;return i.createElement(V.AnnotationList,{annotationBlocks:this.props.annotationBlocks,initialScrollPosition:this.props.initialScrollPosition,onScroll:this.debouncedAnnotationsScrollChanged,lineHeight:this.state.editorLineHeight,height:t,ref:e=>{this.annotationsList=e,e&&this.editor.value&&e.scrollTo(this.editor.value.getScrollTop())},selectedLine:this.selectedLine})}return null})),this.editor.subscribe(this.onEditorChanged),this.timerManagement=new w.TimerManagement,this.debouncedAnnotationsScrollChanged=this.timerManagement.debounce(this.annotationsScrollChanged,50,{maxWait:200}),this.state={editorLineHeight:16}}render(){return i.createElement(b.ScreenSizeObserver,null,(e=>(this.annotationPaneWidth.value=e.screenSize>0?parseInt(""+(0,x.tryGetLocalStorageValue)(o))||300:100,i.createElement(N.Splitter,{fixedElement:0,splitterDirection:0,initialFixedSize:this.annotationPaneWidth.value,nearElementClassName:"flex-column",farElementClassName:"flex-column",onFixedSizeChanged:e=>{this.annotationPaneWidth.value=e,(0,x.trySetLocalStorageValue)(o,""+e)},onRenderNearElement:this.onRenderNearElement,onRenderFarElement:this.onRenderFarElement}))))}componentWillUnmount(){super.componentWillUnmount(),this.timerManagement.dispose()}}t[e].AnnotatedCodeEditor=r}("ComponentsAnnotatedCodeEditor"),function(e){W=t[e]={};class n extends i.Component{render(){const e=[];if(this.props.getDownloadUrl){const t=this.props.getDownloadUrl();e.push({href:t,text:O.Download})}return this.props.onlyIncludeContent?i.createElement(D.MessageBar,{buttonProps:e,severity:"Info"},(0,f.format)(O.BinaryFileMessageFormat,this.props.content.metadata.extension)):i.createElement(P.MessageCard,{className:"flex-grow",buttonProps:e},(0,f.format)(O.BinaryFileMessageFormat,this.props.content.metadata.extension))}componentDidMount(){this.props.onLoaded&&this.props.onLoaded()}}t[e].BinaryViewer=n,m.Components.add("repos-binary-viewer",n);class o extends i.Component{render(){const e=[];let t;if(this.props.originalContent.objectId===this.props.modifiedContent.objectId){if(this.props.getModifiedDownloadUrl){const t=this.props.getModifiedDownloadUrl();e.push({href:t,text:O.Download})}t=O.BinaryIdenticalMessageFormat}else{if(this.props.getOriginalDownloadUrl){const t=this.props.getOriginalDownloadUrl();e.push({href:t,text:O.DownloadOriginal})}if(this.props.getModifiedDownloadUrl){const t=this.props.getModifiedDownloadUrl();e.push({href:t,text:O.DownloadModified})}t=O.BinaryDifferentMessageFormat}return this.props.onlyIncludeContent?i.createElement(D.MessageBar,{buttonProps:e,severity:"Info"},t):i.createElement(P.MessageCard,{className:"flex-grow",buttonProps:e},t)}componentDidMount(){this.props.onLoaded&&this.props.onLoaded()}}t[e].BinaryDiffViewer=o,m.Components.add("repos-binary-diff-viewer",o)}("ComponentsBinaryViewer"),function(e){A=t[e]={};class o extends m.VssComponent{constructor(e,t){super(e,t),this.messageDismissed=new n.ObservableValue(!1),this.performedInitialNav=!1,this.timerManagement=new w.TimerManagement,this.totalAddedLines=0,this.totalRemovedLines=0,this.delayedHighlighting=(e,t)=>{const i=`${t}-highlight`,n=this.diffEditor.getModifiedEditor(),o=n.deltaDecorations.bind(n),r=new Map;e.forEach((e=>{const t=r.get(e.startLineNumber)||[];t.push(new monaco.Range(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn)),r.set(e.startLineNumber,t)}));let s=[];const a=e=>{s=o(s,e?[{range:e,options:{className:i}}]:[])};n.onMouseMove((e=>{var t;const i=e.target.range;if(i){const e=null!==(t=r.get(i.startLineNumber))&&void 0!==t?t:[];for(const t of e)if(t.intersectRanges(i))return a(t)}a(null)})),n.onMouseLeave((()=>a(null))),n.onMouseDown((()=>a(null))),n.onMouseUp((()=>a(null)))},this.onContentUpdated=e=>{if(this.props.onContentChanged){const t=e.getModel();this.props.onContentChanged(t.modified.getValue())}},this.nextDiff=()=>{if(this.diffEditor.getOriginalEditor().hasTextFocus()){const e=this.diffEditor.getOriginalEditor().getPosition();this.nextDiffFromOriginalLine(e?e.lineNumber:0)}else{const e=this.diffEditor.getModifiedEditor().getPosition();this.nextDiffFromModifiedLine(e?e.lineNumber:0)}},this.prevDiff=()=>{if(this.diffEditor.getOriginalEditor().hasTextFocus()){const e=this.diffEditor.getOriginalEditor().getPosition()||{lineNumber:0};this.prevDiffFromOriginalLine(e.lineNumber)}else{const e=this.diffEditor.getModifiedEditor().getPosition()||{lineNumber:0};this.prevDiffFromModifiedLine(e.lineNumber)}};(0,I.getEditorUserPreferencesService)(t.pageContext).getPreferences().subscribe((()=>this.diffEditor&&this.diffEditor.updateOptions(this.getDiffEditorOptions(this.screenSizeCache))))}render(){this.diffOrientation=1,this.props.diffOrientation&&2===n.ObservableLike.getValue(this.props.diffOrientation)&&(this.diffOrientation=2);const{addDiffKeyboardShortcuts:e,showMarginForIcons:t}=this.props;return i.createElement(M.ChangesContext.Consumer,null,(n=>i.createElement(b.ScreenSizeObserver,null,(o=>{this.screenSizeCache=o.screenSize;let r=null;(this.props.modifiedContent.contentTruncated||this.props.originalContent.contentTruncated)&&(r=i.createElement(g.Observer,{dismissed:this.messageDismissed},(e=>!e.dismissed&&i.createElement(D.MessageBar,{className:"flex-noshrink",onDismiss:()=>this.messageDismissed.value=!0,severity:"Warning"},O.DiffContentTruncated))));const s=i.createElement(U.DiffEditor,{actions:t=>{let i=[(0,I.getEditorUserPreferencesService)(this.context.pageContext).getAction(!0)];return e&&(i||(i=[]),i.push({id:"tfs-pr-next-diff",label:O.NextDiff,keybindings:[monaco.KeyCode.F7],run:e=>{n.navigationService.nextDiff()}}),i.push({id:"tfs-pr-previous-diff",label:O.PreviousDiff,keybindings:[monaco.KeyMod.Shift|monaco.KeyCode.F7],run:e=>{n.navigationService.previousDiff()}})),i},className:(0,m.css)("repos-diff-editor flex-grow",t&&"repos-diff-editor-with-margin-icon"),originalContent:this.props.originalContent.content,modifiedContent:{content:this.props.modifiedContent.content,contentUri:this.props.modifiedContent.resourceUri},fileExtension:this.props.modifiedContent.metadata.extension,fileUrl:this.props.modifiedContent.resourceUri,editorOptions:this.getDiffEditorOptions(o.screenSize),editorRef:e=>{this.onEditorRef(e,n.navigationService)},onContentUpdated:this.onContentUpdated,widgets:this.props.diffWidgets,delayedHighlighting:this.delayedHighlighting});return r?i.createElement("div",{className:"flex-column flex-grow"},r,i.createElement("div",{className:"flex-row flex-grow"},s)):s}))))}componentDidMount(){super.componentDidMount(),this.observe([{propertyName:"diffOrientation",observer:e=>{this.diffOrientation!==e&&(this.diffOrientation=e,this.diffEditor&&(this.diffEditor.updateOptions(this.getDiffEditorOptions(this.screenSizeCache)),this.props.onDiffOrientationChanged&&this.props.onDiffOrientationChanged(e)))}},{propertyName:"scrollToLine",observer:e=>{if(void 0===e)this.nextDiffFromModifiedLine(0);else{const t={column:0,lineNumber:e};this.diffEditor.getModifiedEditor().setPosition(t),this.diffEditor.revealPositionInCenter(t)}}}])}onEditorRef(e,t){this.diffEditor=e,this.props.onLoaded&&this.props.onLoaded(),(0,F.unregisterDefaultKeyBindings)(this.diffEditor.getOriginalEditor(),"ctrl+K"),(0,F.unregisterDefaultKeyBindings)(this.diffEditor.getModifiedEditor(),"ctrl+K"),this.diffEditor.onDidUpdateDiff((()=>{this.onDiffUpdated(t)})),this.diffEditor.getModifiedEditor().onDidChangeCursorPosition((()=>{this.updateDiffNavigationFromModifiedPosition(t)})),this.diffEditor.getOriginalEditor().onDidChangeCursorPosition((()=>{this.updateDiffNavigationFromOriginalPosition(t)}))}getDiffEditorOptions(e){const t=0===e,i=!!this.props.diffWidgets,n=(0,I.getEditorUserPreferencesService)(this.context.pageContext).getEditorOptions(!!this.props.editable,void 0,!t&&i,t);return n.renderSideBySide=1===this.diffOrientation,n}updateDiffNavigationFromModifiedPosition(e){if(!e)return;const t={hasNextDiff:!1,hasPreviousDiff:!1,nextDiff:this.nextDiff,previousDiff:this.prevDiff,totalAddedLines:this.totalAddedLines,totalRemovedLines:this.totalRemovedLines},i=this.diffEditor.getModifiedEditor().getPosition()||{lineNumber:0},n=this.diffEditor.getLineChanges()||[];for(const e of n)e.modifiedStartLineNumber>i.lineNumber&&(t.hasNextDiff=!0),e.modifiedStartLineNumber>0&&e.modifiedStartLineNumber<i.lineNumber&&(t.hasPreviousDiff=!0);e.setDiffNavigation(t)}updateDiffNavigationFromOriginalPosition(e){if(!e)return;const t={hasNextDiff:!1,hasPreviousDiff:!1,nextDiff:this.nextDiff,previousDiff:this.prevDiff,totalAddedLines:this.totalAddedLines,totalRemovedLines:this.totalRemovedLines},i=this.diffEditor.getOriginalEditor().getPosition()||{lineNumber:0},n=this.diffEditor.getLineChanges()||[];for(const e of n)e.originalStartLineNumber>i.lineNumber&&(t.hasNextDiff=!0),e.originalStartLineNumber>0&&e.originalStartLineNumber<i.lineNumber&&(t.hasPreviousDiff=!0);e.setDiffNavigation(t)}onDiffUpdated(e){this.totalAddedLines=0,this.totalRemovedLines=0;const t=this.diffEditor.getLineChanges()||[];for(const e of t)e.originalEndLineNumber>0&&(this.totalRemovedLines+=e.originalEndLineNumber-e.originalStartLineNumber+1),e.modifiedEndLineNumber>0&&(this.totalAddedLines+=e.modifiedEndLineNumber-e.modifiedStartLineNumber+1);if(this.updateDiffNavigationFromModifiedPosition(e),!this.performedInitialNav)if(this.performedInitialNav=!0,this.props.scrollToLine&&this.props.scrollToLine.value){const e={column:0,lineNumber:this.props.scrollToLine.value};this.diffEditor.getModifiedEditor().setPosition(e),this.diffEditor.revealPositionInCenter(e)}else e&&(e.getNavigateToFirstDiffOnLoad()?this.nextDiffFromModifiedLine(0):e.getNavigateToLastDiffOnLoad()&&this.timerManagement.setTimeout((()=>{this.prevDiffFromModifiedLine(Number.MAX_SAFE_INTEGER)}),300))}nextDiffFromModifiedLine(e){const t=this.diffEditor.getLineChanges()||[];for(const i of t)if(i.modifiedStartLineNumber>e){const e={column:0,lineNumber:i.modifiedStartLineNumber};return this.diffEditor.getModifiedEditor().setPosition(e),this.diffEditor.revealPositionInCenter(e),!0}return!1}nextDiffFromOriginalLine(e){const t=this.diffEditor.getLineChanges()||[];for(const i of t)if(i.originalStartLineNumber>e){const e={column:0,lineNumber:i.originalStartLineNumber};return this.diffEditor.getOriginalEditor().setPosition(e),this.diffEditor.revealPositionInCenter(e),!0}return!1}prevDiffFromModifiedLine(e){const t=this.diffEditor.getLineChanges()||[];for(let i=t.length-1;i>=0;i--)if(t[i].modifiedStartLineNumber<e){const e={column:0,lineNumber:t[i].modifiedStartLineNumber};return this.diffEditor.getModifiedEditor().setPosition(e),this.diffEditor.revealPositionInCenter(e),!0}return!1}prevDiffFromOriginalLine(e){const t=this.diffEditor.getLineChanges()||[];for(let i=t.length-1;i>=0;i--)if(t[i].originalStartLineNumber<e){const e={column:0,lineNumber:t[i].originalStartLineNumber};return this.diffEditor.getOriginalEditor().setPosition(e),this.diffEditor.revealPositionInCenter(e),!0}return!1}}t[e].CodeDiffEditor=o}("ComponentsCodeDiffEditor"),function(e){H=t[e]={};class n extends m.VssComponent{render(){return i.createElement("div",{className:"repos-editor-image-container"},i.createElement("img",{className:"repos-editor-image",src:this.props.url,title:this.props.content.metadata.fileName}))}componentDidMount(){this.props.onLoaded&&this.props.onLoaded()}}t[e].ImageViewer=n,m.Components.add("repos-image-viewer",n);class o extends m.VssComponent{constructor(){super(...arguments),this.state={canvasHeight:100,canvasWidth:100},this.drawPixelDiff=async e=>{if(e){const t=r(this.props.originalContentUrl),i=r(this.props.modifiedContentUrl),n=await t,o=await i,s=Math.max(n.width,o.width),a=Math.max(n.height,o.height);this.setState({canvasHeight:a,canvasWidth:s});const l=e.getContext("2d");l.drawImage(n,0,0,n.width,n.height);const d=l.getImageData(0,0,s,a);l.clearRect(0,0,s,a),l.drawImage(o,0,0,o.width,o.height);const c=l.getImageData(0,0,s,a),f=l.getImageData(0,0,s,a);for(let e=0;e<f.data.length;e+=4)f.data[e]=Math.abs(d.data[e]-c.data[e]),f.data[e+1]=Math.abs(d.data[e+1]-c.data[e+1]),f.data[e+2]=Math.abs(d.data[e+2]-c.data[e+2]),f.data[e+3]=255;l.putImageData(f,0,0,0,0,s,a)}}}render(){return i.createElement(g.Observer,{diffOrientation:this.props.diffOrientation},(e=>{const t=2===e.diffOrientation;return this.props.isPixelDiff?i.createElement("div",{className:"repos-editor-image-container"},i.createElement("canvas",{className:"repos-editor-image",height:this.state.canvasHeight,width:this.state.canvasWidth,ref:this.drawPixelDiff})):i.createElement("div",{className:t?"flex-column flex-grow":"flex-row flex-grow"},i.createElement("div",{className:"flex-grow flex-noshrink repos-image-diff-item"},i.createElement("div",{className:"repos-editor-image-container"},i.createElement("img",{className:"repos-editor-image",src:this.props.originalContentUrl,title:this.props.originalContent.metadata.fileName}))),i.createElement("div",{className:"flex-grow flex-noshrink repos-image-diff-item"},i.createElement("div",{className:"repos-editor-image-container"},i.createElement("img",{className:"repos-editor-image",src:this.props.modifiedContentUrl,title:this.props.modifiedContent.metadata.fileName}))))}))}componentDidMount(){this.props.onLoaded&&this.props.onLoaded()}}function r(e){return new Promise((t=>{const i=new Image;i.src=e,i.onload=function(){t(i)}}))}t[e].ImageDiffViewer=o,m.Components.add("repos-image-diff-viewer",o)}("ComponentsImageViewer"),function(e){t[e]={};t[e].DiffViewer=e=>{let t,n=null;return e.modifiedContent.metadata.isBinary?(t="",n=e.modifiedContent.metadata.isImage&&e.getModifiedDownloadUrl&&e.getOriginalDownloadUrl?i.createElement(H.ImageDiffViewer,{diffOrientation:e.diffOrientation,isPixelDiff:e.isPixelDiff,modifiedContent:e.modifiedContent,modifiedContentUrl:e.getModifiedDownloadUrl(),onLoaded:e.onLoaded,originalContent:e.modifiedContent,originalContentUrl:e.getOriginalDownloadUrl()}):i.createElement(W.BinaryDiffViewer,{getModifiedDownloadUrl:e.getModifiedDownloadUrl,getOriginalDownloadUrl:e.getOriginalDownloadUrl,modifiedContent:e.modifiedContent,onLoaded:e.onLoaded,originalContent:e.originalContent})):(t=e.editorClassName,n=i.createElement(A.CodeDiffEditor,{addDiffKeyboardShortcuts:e.addDiffKeyboardShortcuts,diffOrientation:e.diffOrientation,diffWidgets:e.diffWidgets,editable:e.editable,isPixelDiff:e.isPixelDiff,modifiedContent:e.modifiedContent,scrollToLine:e.scrollToLine,onContentChanged:e.onContentChanged,onDiffOrientationChanged:e.onDiffOrientationChanged,onLoaded:e.onLoaded,originalContent:e.originalContent,showMarginForIcons:e.showMarginForIcons})),i.createElement(y.ErrorBoundary,{handlerComponentType:"tfs.page-error-handler"},i.createElement("div",{className:(0,m.css)(e.className,t)},n))},m.Components.add("repos-diff-viewer",t[e].DiffViewer)}("ComponentsDiffViewer"),function(e){t[e]={};t[e].FileViewer=e=>{let t,n=null;return e.content.metadata.isBinary?(t="",n=e.content.metadata.isImage&&e.getDownloadUrl?i.createElement(H.ImageViewer,{content:e.content,onLoaded:e.onLoaded,url:e.getDownloadUrl(!1)}):i.createElement(W.BinaryViewer,{content:e.content,onLoaded:e.onLoaded,getDownloadUrl:e.getDownloadUrl?()=>e.getDownloadUrl(!0):void 0})):e.annotationBlocks?(t=e.editorClassName,n=i.createElement(B.AnnotatedCodeEditor,{annotationBlocks:e.annotationBlocks,content:e.content,editable:e.editable,initialScrollPosition:e.initialScrollPosition,onLoaded:e.onLoaded,onScrollChanged:e.onScrollChanged,scrollToLine:e.scrollToLine,showMarginForIcons:e.showMarginForIcons})):(t=e.editorClassName,n=i.createElement(k.CodeEditor,{content:e.content,editable:e.editable,editorWidgets:e.editorWidgets,initialScrollPosition:e.initialScrollPosition,onContentChanged:e.onContentChanged,onLoaded:e.onLoaded,onScrollChanged:e.onScrollChanged,getCodeSelectionLinkUrl:e.getCodeSelectionLinkUrl,getDownloadUrl:e.getDownloadUrl,initialSelectedText:e.initialSelectedText,scrollToLine:e.scrollToLine,showMarginForIcons:e.showMarginForIcons})),i.createElement(y.ErrorBoundary,{handlerComponentType:"tfs.page-error-handler"},i.createElement("div",{className:(0,m.css)(e.className,t)},n))},m.Components.add("repos-file-viewer",t[e].FileViewer)}("ComponentsFileViewer")}),["Resources","Components/EditorPreferencesPanel","UserPreferencesService","SearchContextMenuItemExtension","Components/AnnotationList","Components/Shortcuts","Components/CodeEditor","Components/AnnotatedCodeEditor","Components/BinaryViewer","Components/CodeDiffEditor","Components/ImageViewer","Components/DiffViewer","Components/FileViewer"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-code-web.editor-content"}}));