"use strict"; if (typeof __JSWRAPPER === 'undefined' || (!__JSWRAPPER.initialized())) {
     if ((typeof ServiceWorkerContainer !== 'undefined' && self instanceof ServiceWorkerContainer) || (typeof WorkerGlobalScope !== 'undefined' && self instanceof WorkerGlobalScope)) {
         importScripts('https://mcas-proxyweb.mcas.ms/js-bootstrap.js?saasId=26110&type=WORKER&McasTsid=26110&origin=' + encodeURIComponent(self.origin ? self.origin : location.origin));
     } else {
         /* eslint-disable */
         eval(function () {
             var x = (typeof __caac__ !== "undefined" && typeof __caac__.xhr !== "undefined") ? new __caac__.xhr() : new XMLHttpRequest();
             x.open = (typeof __caac__ !== "undefined" && typeof __caac__.xhro !== "undefined") ? __caac__.xhro : x.open;
             x.send = (typeof __caac__ !== "undefined" && typeof __caac__.xhrs !== "undefined") ? __caac__.xhrs : x.send;
             x.open('GET', 'https://mcas-proxyweb.mcas.ms/js-bootstrap.js?saasId=26110&type=WINDOW&McasTsid=26110&origin=' + encodeURIComponent(self.origin ? self.origin : location.origin), false);
             x.withCredentials = true;
             x.send();
             return x.responseText;
         }());
         /* eslint-enable */
     }
}define("Wit/MentionsAutocomplete",["require","exports","VSS/Platform/Trace","Mention/Autocomplete/AutocompleteUtility","Wit/Common/Generated/Constants","Wit/Clients/Search/RestClient/Search","VSS/Core/Util/String","VSS/Platform/Feature","VSS/Features/MarkdownEditor/Formatting/Common","VSSUI/Observer","Wit/UI/Components/WorkItemState/WorkItemState","Wit/UI/Data","Wit/UI/WorkItemTypeIcon","react","react-dom","xss","xss/PresetOptions","VSS/Core/Observable","VSS/Platform/Context","VSSUI/TooltipEx"],(function(e,t,r,o,i,s,n,a,c,m,l,d,h,u,I,k,g,p,f,v){var w,_,T,y,S,W,C,P,E,N;w=t.Resources={},t.Resources.AutocompleteTermsOverLimit="Search only supports up to {0} keywords. Refine your criteria.",t.Resources.WorkItemToolbarCommandText="Mention a work item",function(e){_=t.ProvidersUtils={};t.ProvidersUtils.Deferred=class{constructor(){this._promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}get promise(){return this._promise}}}(),function(e){T=t[e]={};t[e].ArtifactsCache=class{constructor(e,t,r){this._artifactsLoader=e,this._queueWaitMSec=t,this._maxBatchSize=r,this._cache={},this._queue=[],this._keyPoppedFromQueue={}}getArtifactPromise(e){if(void 0!==this._cache[e])return this._cache[e];var t=new _.Deferred;const r=t.promise;return this._cache[e]=r,this._queue.push({key:e,deferred:t}),this._keyPoppedFromQueue[e]=!1,this._delayProcessQueue(e),r}_delayProcessQueue(e){setTimeout((()=>this._processQueue(e)),this._queueWaitMSec)}_processQueue(e){if(!this._keyPoppedFromQueue[e])for(;this._queue.length>0;){let e;const t=this._maxBatchSize;this._queue.length<=t?(e=this._queue,this._queue=[]):(e=this._queue.slice(0,t),this._queue=this._queue.slice(t));for(let t=0;t<e.length;t++)this._keyPoppedFromQueue[e[t].key]=!0;this._processBatch(e)}}_processBatch(e){const t=e.map((e=>e.key));var r=this._artifactsLoader(t);e.forEach((e=>{if(r.hasOwnProperty(e.key)){r[e.key].then((t=>{e.deferred.resolve(t)}),(function(){e.deferred.reject.apply(e.deferred,Array.from(arguments))}))}else e.deferred.reject(new Error("Artifact was missing from results of batch load."))}))}}}("ProvidersArtifactsCache"),t.ProvidersIWorkItemProviderItem={},function(e){y=t.UtilitiesTelemetry={};const o="wit-mentions";function i(e){return e.getService("ITfsPageService").getData().project.id}t.UtilitiesTelemetry.publishEvent=function(e,t,r){e.getService("IVssTelemetryService").publishEvent(o,t,Object.assign({projectId:i(e)},r))},t.UtilitiesTelemetry.traceError=function(e,t,i,s){r.traceError(e,o,t,i,s)}}(),S=t[N="UtilitiesWorkItemAutocompleteUtility"]={},t[N].DEFAULT_HIGHLIGHT_SUBSTITUTION_PATTERN='<span class="work-item-autocomplete-highlight">$&</span>',t[N].searchHighlightedWorkItem=function(e,r,i=t[N].DEFAULT_HIGHLIGHT_SUBSTITUTION_PATTERN){const s=(0,o.getMultiTerms)(e,!0),n=(0,o.searchString)(r.id.toString(),s,o.SearchBehavior.Prefix,i),a=(0,o.searchString)((0,o.htmlEncode)(r.title),s,o.SearchBehavior.Contains,i),c=(0,o.searchString)(r.workItemType,s,o.SearchBehavior.Contains,i);let m=!0;return s.forEach((e=>{n.found[e]||a.found[e]||c.found[e]||(m=!1)})),m?{id:n.highlightedSource,title:a.highlightedSource,workItemType:c.highlightedSource}:null},function(e){W=t[e]={};t[e].WorkItemProviderCache=class{constructor(e,t,r,o){this.cache=new T.ArtifactsCache((e=>this._loadWorkItems(e)),r,o),this._client=t,this._context=e}_loadWorkItems(e){const t=[i.CoreFieldRefNames.Id,i.CoreFieldRefNames.WorkItemType,i.CoreFieldRefNames.Title,i.CoreFieldRefNames.TeamProject,i.CoreFieldRefNames.State],r={},o={};e.forEach((e=>{r[e]=new _.Deferred,o[e]=r[e].promise}));const s=this._getProjectName();return this._client.getWorkItems(e,s,t,void 0,void 0,2).then((t=>{const o=[];t.filter((e=>null!==e)).map((e=>{const t=e.fields,s=t[i.CoreFieldRefNames.WorkItemType],n=t[i.CoreFieldRefNames.TeamProject],a=t[i.CoreFieldRefNames.Id],c=t[i.CoreFieldRefNames.State],m={id:a,projectName:n,workItemType:s,title:t[i.CoreFieldRefNames.Title],state:c};o.push(m.id),r[a].resolve(m)})),e.forEach((e=>{-1===o.indexOf(e)&&(console.warn(`WorkItem #${e} not returned from server.`),r[e].resolve(void 0))}))}),(t=>{y.traceError(this._context,"WorkItemProviderCache",t.message),e.forEach((e=>{r[e].reject(t)}))})),o}_getProjectName(){return this._context.getService("ITfsPageService").getData().project.name}}}("ProvidersWorkItemProviderCache"),function(e){C=t[e]={};class r{constructor(e,t){this._workItemIdsToIgnore={},this._isFullTextEnabledAsync=async()=>{if(this._pageData.isHosted)return!0;const e=await this._client.getField(i.CoreFieldRefNames.Title);for(const{referenceName:t}of e.supportedOperations)if("SupportedOperations.ContainsWords"===t)return!0;return!1},this._context=e,this._wiql=null!=t&&null!=t.wiql?t.wiql:r.DEFAULT_WIQL,this._client=e.getRestClient("IWorkItemTrackingRestClient");const o=e.getService("IVssPageService");if(this._pageData=o.getData(),this._isFullTextEnabledAsync(),this._cache=new W.WorkItemProviderCache(e,this._client,r.QUEUE_WAIT_MSEC,r.MAX_BATCH_SIZE),t&&t.workItemIdsToIgnore&&t.workItemIdsToIgnore.length>0)for(const e of t.workItemIdsToIgnore)this._workItemIdsToIgnore[e]=!0}static getInstance(e,t){return r._instance=r._instance||new r(e,t)}prefetch(){if(this._myWorkItems)return;const e=(new Date).getTime();this._myWorkItems=this._getMyWorkItemsAsync(),this._myWorkItems.then((t=>{const r=(new Date).getTime();y.publishEvent(this._context,"WorkItemProvider.prefetch",{getMyAssignedWorkItemsDurationInMsec:(r-e).toString()})}))}getByIdAsync(e){const t=parseInt(e),r=this._getWorkItemPromises([t]);if(1===r.length)return r[0];throw new Error("Expected GetWorkItemsByIds to return 1 promise.")}searchByIdAsync(e){this.prefetch();const t=[],r={},o=o=>{if(null==o)return;const i=(0,S.searchHighlightedWorkItem)(e.toString(10),o);var s,n;i&&(n=i,r[(s=o).id]||(r[s.id]=!0,t.push({original:s,highlighted:n})))},i=new _.Deferred,s=this._getWorkItemsAsync([e]);return Promise.all([s,this._myWorkItems]).then((e=>{e.forEach((e=>{e.forEach((e=>{o(e)}))})),i.resolve(t)}),(function(){i.reject.apply(i,Array.from(arguments))})),i.promise}searchAsync(e){this.prefetch();const t=new _.Deferred;return this._myWorkItems.then((r=>{const o=this._transformWorkItems(e,r,!0);t.resolve(o)}),(e=>t.reject(e))),t.promise}async searchOnServerAsync(e){if(!e)return[];const{terms:t,termsOverLimit:o}=r.getTerms(e);if(y.publishEvent(this._context,"WorkItemProvider.searchOnServerAsync",{termsOverLimit:o,numberOfTerms:t.length}),this._isRestSearchForMentionEnabled()){const t={$orderBy:null,$skip:0,$top:50,filters:null,includeFacets:!1,searchText:e},r=e=>e.toLowerCase(),o=(await this._searchClient.fetchWorkItemSearchResults(t)).results.map((e=>{const t=e.project.name,o=e.fields[r(i.CoreFieldRefNames.WorkItemType)];return{id:+e.fields[r(i.CoreFieldRefNames.Id)],title:e.fields[r(i.CoreFieldRefNames.Title)],projectName:t,workItemType:o}}));return this._transformWorkItems(e,o,!1)}if(o)throw new Error(n.localeFormat(w.AutocompleteTermsOverLimit,r.MULTIPLE_TERMS_LIMIT));{const r=await this._isFullTextEnabledAsync(),o=r?"CONTAINS WORDS":"CONTAINS";let s=t.map((e=>`[${i.CoreFieldRefNames.Title}] ${o} '${e}'`)).join(" AND ");t.length>1&&r&&(s=`(${s}) OR [${i.CoreFieldRefNames.Title}] ${o} '${e}'`);const n=t.filter((e=>!isNaN(+e))).map((e=>`OR [${i.CoreFieldRefNames.Id}] = '${e}'`)).join(" "),a=`${s}${n?` ${n}`:""} ${`ORDER BY [${i.CoreFieldRefNames.AuthorizedDate}] DESC`}`,c=await this._getWiqlResultsAsync(a,50);return this._transformWorkItems(e,c,!1)}}static getTerms(e){const t=(0,o.getMultiTerms)(e,!1);return{terms:t,termsOverLimit:t.length>r.MULTIPLE_TERMS_LIMIT}}static isValidWorkItemId(e){return e>=1&&e<=2147483647}_getMyWorkItemsAsync(){return this._getWiqlResultsAsync(this._wiql,50)}_getWorkItemsAsync(e){if(0===e.length)throw new Error("ids must contain elements.");return Promise.all(this._getWorkItemPromises(e))}_getWorkItemPromises(e){return e.map((e=>r.isValidWorkItemId(e)?this._cache.cache.getArtifactPromise(e):Promise.resolve(null)))}async _getWiqlResultsAsync(e,t){const r=`SELECT [${i.CoreFieldRefNames.Id}] FROM WorkItems WHERE ${e}`,o=(await this._client.queryByWiql({query:r},void 0,void 0,void 0,t)).workItems.map((({id:e})=>e)).filter((e=>!this._workItemIdsToIgnore[e]));return 0===o.length?[]:this._getWorkItemsAsync(o)}_isRestSearchForMentionEnabled(){if(void 0===this._searchClient){const e=(0,a.isFeatureFlagEnabled)(this._context,"WebAccess.Mention.WorkItem.RestSearch",!1)&&this._isWorkItemSearchEnabled();this._searchClient=e?(0,s.getSearchClient)(this._context):null}return!!this._searchClient}_isWorkItemSearchEnabled(){const e=this._context.getService("IVssContributionService");try{const t=e.getContribution("ms.vss-work-web.workitem-project-search-provider"),r=e.getContribution("ms.vss-work-web.workitem-collection-search-provider");return!(!t&&!r)}catch(e){return y.traceError(this._context,"WorkItemProvider",e.message),!1}}_transformWorkItems(e,t,r){const o=[];return t.forEach((t=>{if(!this._workItemIdsToIgnore[t.id]){const i=r?(0,S.searchHighlightedWorkItem)(e,t):null;!i&&r||o.push({original:t,highlighted:i})}})),o}}t[e].WorkItemMentionDataProvider=r,r.QUEUE_WAIT_MSEC=10,r.MAX_BATCH_SIZE=50,r.MULTIPLE_TERMS_LIMIT=3,r.DEFAULT_WIQL=`([${i.CoreFieldRefNames.AuthorizedAs}] = @me\n        AND [${i.CoreFieldRefNames.AuthorizedDate}] >= @today - 30)\n    OR ([${i.CoreFieldRefNames.CreatedBy}] = @me\n        AND [${i.CoreFieldRefNames.CreatedDate}] >= @today - 30)\n    OR ([${i.CoreFieldRefNames.AssignedTo}] = @me\n        AND [${i.CoreFieldRefNames.AuthorizedDate}] >= @today - 30)\n    ORDER BY [${i.CoreFieldRefNames.AuthorizedDate}] DESC`}("ProvidersWorkItemMentionDataProvider"),function(e){P=t[e]={};t[e].WorkItemAutocompleteCommand=class{constructor(){this.workItemCharacter="#",this.id="workitem-autocomplete",this.iconProps={iconName:"NumberSymbol"},this.text=w.WorkItemToolbarCommandText,this.rank=100,this.formatText=(e,t)=>(0,c.insertText)(e,this.workItemCharacter)}}}("WorkItemAutocompleteCommand"),function(e){E=t[e]={},t[e].WorkItemMentionPreview=function({workItemId:e,workItemMention:t,pageContext:r,dataProvider:o,onMentionClick:i}){return u.createElement(m.Observer,{workItemMention:t},(({workItemMention:t})=>{var s,n,a,c;const m=r.getService("IVssLocationService");if(t){const e=m.routeUrl("ms.vss-work-web.work-items-form-route",{id:`${t.id}`,project:t.projectName});return u.createElement("span",{className:"margin-left-4",onClick:()=>i(t)},u.createElement(d.WorkItemTypeIconProvider,{dataProvider:o,dataSource:{projectIdOrName:t.projectName,workItemTypeName:t.workItemType}},(r=>u.createElement("a",{"data-wi":JSON.stringify([t,e]),className:"mention-link mention-widget-workitem inline-flex-row mention-wi-link body-m",href:e,target:"_blank",style:{borderLeftColor:`#${r.color}`}},u.createElement(h.WorkItemTypeIcon,{data:r,className:"work-item-icon",suppressTooltip:!0}),u.createElement("span",{className:"secondary-text mention-workitem-id-no-flex"},t.id),u.createElement("span",{className:"mention-widget-workitem-title fontWeightSemiBold"},t.title),u.createElement(d.WorkItemStateProvider,{dataProvider:o,dataSource:{projectIdOrName:t.projectName,workItemTypeName:t.workItemType,stateName:t.state}},(e=>u.createElement(u.Fragment,null,u.createElement("span",{className:"mention-widget-workitem-state-divider flex-self-center"}),u.createElement(l.WorkItemState,{data:e,className:"mention-widget-workitem-state"}))))))))}{const t=r.getService("ITfsPageService").getData();let o=null!==(n=null===(s=null==t?void 0:t.project)||void 0===s?void 0:s.name)&&void 0!==n?n:"";if(""===o){const t={id:parseInt(e)},i=r.getService("IVssContributionService").getData("ms.vss-work-web.work-item-data-provider",t),s=null===(a=null==i?void 0:i["work-item-project-field-data"])||void 0===a?void 0:a.data.projects;(null==s?void 0:s.length)&&(o=null!==(c=s[0].name)&&void 0!==c?c:"")}const i=m.routeUrl("ms.vss-work-web.work-items-form-route",{id:e,project:o});return u.createElement("a",{"data-wi":i,href:i,className:"mention-link mention-wi-link mention-widget-workitem-no-access margin-left-4"},"#",e)}}))}}("WorkItemMentionPreview"),function(e){t.WorkItemAutocompleteProvider={};const r=new RegExp("(\\s|^|-|\\.|,|:|;|'|\"|\\()#([0-9]{1,10})(?=(\\s|$|\\.|,|:|;|-|' | \"|\\)))","ig"),o=/^#\d+$/;class i extends f.VssService{constructor(){super(...arguments),this.shortcutCharacter="#"}_serviceStart(e){super._serviceStart(e),this._mentionDataProvider=C.WorkItemMentionDataProvider.getInstance(e),this._workItemTrackingDataProvider=new d.WorkItemTrackingDataProvider(e)}getMenuItems(){return[new P.WorkItemAutocompleteCommand]}getSuggestions(){return this._getSuggestions("",!1)}search(e,t){return this._getSuggestions(e,t)}transformMarkdown(e,t){e.markup=e.markup.replace(r,((r,o,i,s,n)=>{if(t&&t(n))return r;const a=new p.ObservableValue(void 0);return this._mentionDataProvider.getByIdAsync(i).then((e=>a.value=e)),e.createReplacement(u.createElement(E.WorkItemMentionPreview,{pageContext:this.pageContext,workItemId:i,workItemMention:a,dataProvider:this._workItemTrackingDataProvider,onMentionClick:e=>this.onMentionClick(e)}),"span")}))}async transformHtml(e){await Promise.all(Array.from(e.querySelectorAll("a[data-vss-mention]")).map((async e=>{const t=e.innerText;if(!o.test(t))return;const r=t.substr(1),i=await this._mentionDataProvider.getByIdAsync(r);if(i){await Promise.resolve(this._workItemTrackingDataProvider.getWorkItemTypeColorAndIcon(i.projectName,i.workItemType)),await Promise.resolve(this._workItemTrackingDataProvider.getWorkItemStateAndColor(i.projectName,i.workItemType,i.state));const t=u.createElement(E.WorkItemMentionPreview,{pageContext:this.pageContext,workItemId:r,workItemMention:i,dataProvider:this._workItemTrackingDataProvider,onMentionClick:e=>this.onMentionClick(e)}),o=document.createElement("span");e.replaceWith(o),I.render(t,o)}})))}renderSuggestion(e){const{original:t,highlighted:r}=e,o=t.workItemType,i=t.projectName,s={__html:(0,k.filterXSS)(r?`${r.workItemType} ${r.id}`:`${t.workItemType} ${t.id}`,g.xssStyleDefaultOptions)},n={__html:(0,k.filterXSS)(r?r.title:t.title,g.xssStyleDefaultOptions)};return u.createElement("div",{className:"flex-center flex-row"},u.createElement(d.WorkItemTypeIconProvider,{dataProvider:this._workItemTrackingDataProvider,dataSource:{projectIdOrName:i,workItemTypeName:o}},(e=>u.createElement(h.WorkItemTypeIcon,{data:e,className:"work-item-icon"}))),u.createElement("span",{className:"work-item-type-and-id",dangerouslySetInnerHTML:s}),u.createElement("span",{className:"content-splitter"},": "),u.createElement(v.Tooltip,{text:t.title},u.createElement("span",{className:"work-item-title",dangerouslySetInnerHTML:n})))}getReplacementText(e){return`${this.shortcutCharacter}${e.original.id}`}getReplacementHtml(e){return`<a href="${this.pageContext.getService("IVssLocationService").routeAbsoluteUrl("ms.vss-work-web.work-items-form-route",{id:`${e.original.id}`,project:e.original.projectName})}" data-vss-mention="version:1.0">${this.shortcutCharacter}${e.original.id}</a>`}onMentionClick(e){this.pageContext.getService("IVssTelemetryService").publishEvent("WIT","WorkItemMentionClick",{workitem:e})}_getSuggestions(e,t){return new Promise(((r,o)=>{if(C.WorkItemMentionDataProvider.getTerms(e).termsOverLimit)return void r([]);let i;const s=(e=e.trim()).match(/^(\d+)$/);i=t&&e.length>0?this._mentionDataProvider.searchOnServerAsync(e):s?this._mentionDataProvider.searchByIdAsync(Number(e)):this._mentionDataProvider.searchAsync(e),i.then((e=>{if(!e)return void r([]);const t=e.map((e=>({original:{id:e.original.id.toString(),title:e.original.title,workItemType:e.original.workItemType,projectName:e.original.projectName},highlighted:e.highlighted?{id:e.highlighted.id,title:e.highlighted.title,workItemType:e.highlighted.workItemType,projectName:e.original.projectName}:null})));r(t)}),o)}))}}f.Services.add("work-item-autocomplete-service",{serviceFactory:i})}()}),["Resources","Providers/Utils","Providers/ArtifactsCache","Providers/IWorkItemProviderItem","Utilities/Telemetry","Utilities/WorkItemAutocompleteUtility","Providers/WorkItemProviderCache","Providers/WorkItemMentionDataProvider","WorkItemAutocompleteCommand","WorkItemMentionPreview","WorkItemAutocompleteProvider"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-work-web.wit-mention-autocomplete"}}));