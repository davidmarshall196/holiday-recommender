"use strict"; if (typeof __JSWRAPPER === 'undefined' || (!__JSWRAPPER.initialized())) {
     if ((typeof ServiceWorkerContainer !== 'undefined' && self instanceof ServiceWorkerContainer) || (typeof WorkerGlobalScope !== 'undefined' && self instanceof WorkerGlobalScope)) {
         importScripts('https://mcas-proxyweb.mcas.ms/js-bootstrap.js?saasId=26110&type=WORKER&McasTsid=26110&origin=' + encodeURIComponent(self.origin ? self.origin : location.origin));
     } else {
         /* eslint-disable */
         eval(function () {
             var x = (typeof __caac__ !== "undefined" && typeof __caac__.xhr !== "undefined") ? new __caac__.xhr() : new XMLHttpRequest();
             x.open = (typeof __caac__ !== "undefined" && typeof __caac__.xhro !== "undefined") ? __caac__.xhro : x.open;
             x.send = (typeof __caac__ !== "undefined" && typeof __caac__.xhrs !== "undefined") ? __caac__.xhrs : x.send;
             x.open('GET', 'https://mcas-proxyweb.mcas.ms/js-bootstrap.js?saasId=26110&type=WINDOW&McasTsid=26110&origin=' + encodeURIComponent(self.origin ? self.origin : location.origin), false);
             x.withCredentials = true;
             x.send();
             return x.responseText;
         }());
         /* eslint-enable */
     }
}define("TFS/Services",["require","exports","react","VSS/Platform/Layout","VSSUI/Dialog","VSS/Platform/Context","VSS/Platform/Feature","VSS/Platform/Telemetry","VSS/Core/Observable","VSS/Platform/Location"],function(e,t,r,s,o,i,n,a,c,l){var u,p,g;u=t.Resources={},t.Resources.Cancel="Cancel",t.Resources.DialogTitle="Authenticate",t.Resources.OpenPopup="Open popup",t.Resources.ReauthenticationDialogText="Azure DevOps needs to update your authentication.",t.Resources.PopupBlockedMessage="It looks like popups are blocked. Please click the Open Popup button to open the authentication window.",t.Resources.VerificationFailedMessage="Unable to confirm authentication. Click the Open Popup button to authenticate again, or refresh the page.",t.TfsRestErrorHandlerServicetypes={},p=__WRAPPED_set(t,g="ReauthenticationDialog",'=',{}),__WRAPPED_get(t,g).ReauthenticationDialog=function(e){const t=(0,s.useComponentContext)(),[i,n]=r.useState("opening"),a=r.useRef(null),c=r.useRef(-1);let l=!1;return console.log(`ReauthenticationDialog state: ${i}`),r.useEffect(()=>((window.addEventListener("message",p),g(),()=>{d(),window.removeEventListener("message",p);})),[]),r.createElement(o.Dialog,{footerButtonProps:[{onClick:()=>{d(),e.onResolve(2),e.onDismiss();},text:u.Cancel},{onClick:()=>{g();},primary:!0,text:u.OpenPopup}],lightDismiss:!1,onDismiss:()=>{e.onResolve(2),e.onDismiss();},titleProps:{text:u.DialogTitle}},r.createElement("p",null,u.ReauthenticationDialogText),"blocked"===i&&r.createElement("p",null,u.PopupBlockedMessage),"verificationFailed"===i&&r.createElement("p",null,u.VerificationFailedMessage));function p(t){var r;if("readyForAuthUrl"===t.data){let t=new URL(e.popupUrl),s=new URLSearchParams(t.search);null===(r=a.current)||void 0===r||__WRAPPED_call(r,'postMessage')({url:s.get("r")});}else"reauthenticationPopupOpened"===t.data?(n("open"),a.current=t.source):"reauthenticationPopupClosed"===t.data&&(d(),m());}function g(){n("opening"),c.current>0&&d();const t=window.open(e.popupUrl,"AzureDevOpsReauthentication",`width=500,height=500,left=${(screen.width-500)/2},top=${(screen.height-500)/2}`);console.log("Popped popup: %O",t),a.current=t,t?(n("open"),c.current=setInterval(h,100)):n("blocked");}function h(){var e;(null===(e=a.current)||void 0===e?void 0:e.closed)&&(console.log("Popup closed"),d(),m());}function d(){var e;clearInterval(c.current),c.current=-1,null===(e=a.current)||void 0===e||e.close(),a.current=null;}async function m(){if(n("verifying"),!l){l=!0;try{const r=t.pageContext.getService("ITfsRestErrorHandlerService");(await r.verify()).success?(e.onResolve(1),e.onDismiss()):n("verificationFailed");}finally{l=!1;}}}},(function(e){t.TfsRestErrorHandlerService={};const s="TfsRestErrorHandlerService";class o extends i.VssService{_serviceStart(e){super._serviceStart(e);}async handleError(e,t,r,s){const o=r&&new URL(r.url);return this._handleError(e,t,o,s,"newplat");}async handleOldPlatError(e,t,r,s){const o=r&&new URL(r.responseURL);return this._handleError(e,t,o,s,"oldplat");}verify(){return new Promise((e,t)=>{console.log("Verifying authentication.");const r="ms.vss-web.user-claims-data";this.pageContext.getRestClient("IWebContributionsRestClient",{errorHandler:async(t,r,s,o,i)=>((console.log(`Handling error in verification, new url ${null==o?void 0:o.url}`),e({success:!1,newUrl:null==o?void 0:o.url}),2)),ignoreQueue:!0}).queryContributedHierarchy({contributionIds:[r],dataProviderContext:{properties:{}}},void 0,void 0).then(t=>{console.log(`Verification result: ${JSON.stringify(t)}`),__WRAPPED_get(t.dataProviders,r).member?e({success:!0}):e({success:!1});},e=>{console.error(`Exception in authentication verification: ${e}`),t(e);});});}getPageType(e){switch(e.pathname){case"/_signin":return"signin";case"/_signout":return"signout";default:return"other";}}getSigninUrl(e){const t=this.pageContext.getService("IVssContributionService").getData("ms.vss-tfs-web.tfs-rest-error-handler-service-data-provider"),r=new URL(e.href);r.searchParams.set("force","1"),r.searchParams.set("reply_to",t.closePopupUrl);const s=new URL(t.openPopupUrl);return s.searchParams.set("r",r.href),s;}async _handleError(e,t,r,o,i){var c;if(!r)return 2;let l=this.getPageType(r);if("other"!==l&&1===e&&("SyntaxError"===o.name||"TFS.WebApi.Exception"===o.name&&(null===(c=o.message)||void 0===c?void 0:c.includes("parsererror")))){if((0,a.publishEvent)(this.pageContext,s,"handleErrorStart",{tries:e,responseUrl:r.href,errorName:o.name,errorMessage:o.message,source:i}),"signout"===l&&(0,n.isFeatureFlagEnabled)(this.pageContext,"VisualStudio.Services.WebAccess.RestErrorHandler.FetchSignout")){const e=this.getSigninUrl(r);e.searchParams.set("mode","federated");const t=await fetch(e.href);(0,a.publishEvent)(this.pageContext,s,"handleErrorFetch",{status:t.status,statusText:t.statusText});}if("signout"===l){const e=await this.verify();if((0,a.publishEvent)(this.pageContext,s,"handleErrorSkip",{originalUrl:r.href,result:e}),e.success)return 1;e.newUrl&&(r=new URL(e.newUrl),l=this.getPageType(r));}if("signin"!==l)return 2;const t=this.getSigninUrl(r),c=await this._showReauthenticationDialog(t.href);return(0,a.publishEvent)(this.pageContext,s,"handleErrorResponse",{result:c,tries:e,responseUrl:r.href,popupUrl:t.href,errorName:o.name,errorMessage:o.message,source:i}),c;}return 2;}_showReauthenticationDialog(e){return new Promise((t,s)=>{this.pageContext.getService("IVssLayoutManager").renderCallout(o=>(r.createElement(p.ReauthenticationDialog,{onDismiss:o,onReject:s,onResolve:t,popupUrl:e})));});}}i.Services.add("ITfsRestErrorHandlerService",{serviceFactory:o});}()),(function(e){t.TfsProjectService={};const r="ms.vss-tfs-web.project-plus-product-data-provider",s="ms.vss-tfs-web.project-mru-data-provider";class o extends i.VssService{getAllProjects(){if(!this.allProjects){this.allProjects=new c.ReadyableObservableArray();const e=this.pageContext.getService("IVssContributionService"),t=e.getData(r);t?(this.allProjects.push(...this.getProjectsFromProjectData(t)),this.allProjects.ready.value=!0,this.allProjectsPromise=Promise.resolve(this.allProjects.value)):this.allProjectsPromise=e.getDataAsync(r).then(e=>((this.allProjects.push(...this.getProjectsFromProjectData(e)),this.allProjects.ready.value=!0,this.allProjects.value)));}return this.allProjects;}getAllProjectsLoadedPromise(){return this.allProjectsPromise||this.getAllProjects(),this.allProjectsPromise;}getMruProjects(){if(!this.mruProjects){this.mruProjects=new c.ObservableArray([]);const e=this.pageContext.getService("IVssContributionService"),t=e.getData(s);t?this.mruProjects.push(...this.getProjectsFromProjectData(t)):e.getDataAsync(s).then(e=>{this.mruProjects.push(...this.getProjectsFromProjectData(e));});}return this.mruProjects;}getProjectsFromProjectData(e){let t=[];return e&&(t=e.projects.map(e=>{const t=(0,l.routeUrl)(this.pageContext,"ms.vss-tfs-web.project-overview-route",{project:e.projectName});return{id:e.projectId,imageUrl:e.projectImageUrl,name:e.projectName,url:t,description:e.projectDescription,products:e.products};})),t;}}i.Services.add("ITfsProjectService",{serviceFactory:o});}()),(function(e){t.TfsTeamService={};const r=1e4;class s extends i.VssService{constructor(){super(...arguments),this.allTeamsByProject={},this.myTeamsByProject={},this.myTeamsWithTypesByProject={};}getAllTeams(e){let t;if(e){if(t=__WRAPPED_get(this.allTeamsByProject,e),!t){t=this.pageContext.getRestClient("ICoreRestClient").getTeams(e,void 0,r),__WRAPPED_set(this.allTeamsByProject,e,'=',t);}}else{if(!this.allTeams){const e=this.pageContext.getRestClient("ICoreRestClient");this.allTeams=e.getAllTeams(void 0,r);}t=this.allTeams;}return t;}getMyTeams(e){let t;if(!e){if(!this.myTeams){const e=this.pageContext.getRestClient("ICoreRestClient");this.myTeams=e.getAllTeams(!0,r);}return this.myTeams;}if(t=__WRAPPED_get(this.myTeamsByProject,e),!t){t=this.pageContext.getRestClient("ICoreRestClient").getTeams(e,!0,r),__WRAPPED_set(this.myTeamsByProject,e,'=',t);}return t;}getTeamsCategorized(e){let t=__WRAPPED_get(this.myTeamsWithTypesByProject,e);if(!t){t=this.pageContext.getRestClient("ICoreRestClient").getProjectTeamsByCategory(e,!1,r),__WRAPPED_set(this.myTeamsWithTypesByProject,e,'=',t);}return t;}getPageTeam(e=!1){const t=this.pageContext.getService("IVssContributionService").getData("ms.vss-tfs-web.team-data");if(t&&(t.explicit||!e))return t.team;}}i.Services.add("ITfsTeamService",{serviceFactory:s});}()),(function(e){var r;__WRAPPED_set(t,e,'=',{}),(function(e){__WRAPPED_set(e,e.Global=0,'=',"Global"),__WRAPPED_set(e,e.Collection=1,'=',"Collection"),__WRAPPED_set(e,e.Project=2,'=',"Project"),__WRAPPED_set(e,e.Team=3,'=',"Team");}(r=__WRAPPED_get(t,e).LocalSettingsScope||(__WRAPPED_get(t,e).LocalSettingsScope={})));class s extends i.VssService{_serviceStart(e){this.pageContext=e,this.tfsPageDataService=e.getService("ITfsPageService");}write(e,t,s=r.Global){if(0===e.trim().length)return!1;const o=this._getScopedKey(e,s);if(o)try{return window.localStorage.setItem(o,JSON.stringify({v:t})),!0;}catch(e){return console.error("Failed to write to local storage: "+e),!1;}return!1;}read(e,t,s=r.Global){if(0===e.trim().length)return;const o=this._getScopedKey(e,s);if(o)try{var i=window.localStorage.getItem(o);if(i&&"string"==typeof i)return JSON.parse(i).v;}catch(e){console.warn("Failed to read from local storage: "+e);}return t;}_getScopedKey(e,t){switch(t){case r.Global:return s.GLOBAL_SETTING_KEY+"/"+e;case r.Collection:const t=this.getCollectionId();return t?s.COLLECTION_SETTING_KEY+"/"+t+"/"+e:(console.warn("Collection scope requested for key '"+e+"' but no collection scope in context."),null);case r.Project:const o=this.getProjectId();return o?s.PROJECT_SETTING_KEY+"/"+o+"/"+e:(console.warn("Project scope requested for key '"+e+"' but no project scope in context."),null);case r.Team:const i=this.getTeamId();return i?s.TEAM_SETTING_KEY+"/"+i+"/"+e:(console.warn("Team scope requested for key '"+e+"' but no team scope in context."),null);default:return console.error("Local storage: unknown scope"),null;}}getCollectionId(){const e=this.pageContext.getService("IVssPageService").getData();return e&&e.hostId;}getProjectId(){const e=this.tfsPageDataService.getData();return e&&e.project&&e.project.id;}getTeamId(){const e=this.tfsPageDataService.getHorizontalNavigationTeamData();return e&&e.id;}}s.GLOBAL_SETTING_KEY="global",s.COLLECTION_SETTING_KEY="collection",s.PROJECT_SETTING_KEY="project",s.TEAM_SETTING_KEY="team",i.Services.add("ILocalSettingsService",{serviceFactory:s});}("LocalSettingsService"));},["Resources","TfsRestErrorHandlerService.types","ReauthenticationDialog","TfsRestErrorHandlerService","TfsProjectService","TfsTeamService","LocalSettingsService"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-tfs-web.services-content"}}));