"use strict"; if (typeof __JSWRAPPER === 'undefined' || (!__JSWRAPPER.initialized())) {
     if ((typeof ServiceWorkerContainer !== 'undefined' && self instanceof ServiceWorkerContainer) || (typeof WorkerGlobalScope !== 'undefined' && self instanceof WorkerGlobalScope)) {
         importScripts('https://mcas-proxyweb.mcas.ms/js-bootstrap.js?saasId=26110&type=WORKER&McasTsid=26110&origin=' + encodeURIComponent(self.origin ? self.origin : location.origin));
     } else {
         /* eslint-disable */
         eval(function () {
             var x = (typeof __caac__ !== "undefined" && typeof __caac__.xhr !== "undefined") ? new __caac__.xhr() : new XMLHttpRequest();
             x.open = (typeof __caac__ !== "undefined" && typeof __caac__.xhro !== "undefined") ? __caac__.xhro : x.open;
             x.send = (typeof __caac__ !== "undefined" && typeof __caac__.xhrs !== "undefined") ? __caac__.xhrs : x.send;
             x.open('GET', 'https://mcas-proxyweb.mcas.ms/js-bootstrap.js?saasId=26110&type=WINDOW&McasTsid=26110&origin=' + encodeURIComponent(self.origin ? self.origin : location.origin), false);
             x.withCredentials = true;
             x.send();
             return x.responseText;
         }());
         /* eslint-enable */
     }
}define("Mention/IdentityAutocomplete",["require","exports","VSS/Features/MarkdownEditor/Formatting/Common","VSS/Core/Observable","VSS/Features/Identities/IdentityPickerProvider","react","react-dom","VSS/Platform/Context","VSSUI/Button","VSSUI/IdentityPicker","VSSUI/Observer","VSSUI/Persona","VSSUI/TooltipEx","VSSUI/Util","VSSUI/IdentityCard","Mention/Autocomplete/AutocompleteUtility","VSS/Core/Util/String","Mention/Common/MaterializeIdentityProvider","Mention/Common/Util","VSS/Features/Identities/IdentityService","xss","xss/PresetOptions"],(function(e,t,i,n,a,o,r,s,l,d,c,m,u,p,y,h,g,v,I,S,C,f){var x,N;x=t.Resources={},t.Resources.IdentityPickerProfileCardButtonTooltip="Show Contact Card",t.Resources.IdentityToolbarCommandText="Mention someone",function(e){N=t[e]={};t[e].IdentityAutocompleteCommand=class{constructor(){this.identityCharacter="@",this.id="identity-autocomplete",this.iconProps={iconName:"Accounts"},this.text=x.IdentityToolbarCommandText,this.rank=90,this.formatText=(e,t)=>(0,i.insertText)(e,this.identityCharacter)}}}("IdentityAutocompleteCommand"),function(e){t.IdentityAutocompleteProvider={};const i=/version:\d\.\d,([a-z\d\-]+)/i;class P extends s.VssService{constructor(){super(...arguments),this.resolvedIdentities={},this.identityPromises={},this.shortcutCharacter="@",this.onRequestConnectionInformation=(e,t)=>{if(!e)return{};return this.pageContext.getService(S.VssIdentityServiceName).getConnections(e,t)}}_serviceStart(e){super._serviceStart(e),this.peopleProvider=new a.PeoplePickerProvider(e),this.displayNameTranslationService=this.pageContext.getService("display-name-storage-key-translation-service")}getMenuItems(){return[new N.IdentityAutocompleteCommand]}getSuggestions(){return Promise.resolve(this.peopleProvider.onEmptyInputFocus()).then((e=>this._transformIdentities(e)))}search(e,t){return e?Promise.resolve(this.peopleProvider.onFilterIdentities(e)).then((t=>this._transformIdentities(t,e))):this.getSuggestions()}renderSuggestion(e,t){return o.createElement(T,{item:e,onRequestConnectionInformation:this.onRequestConnectionInformation,pageContext:this.pageContext,input:t})}getReplacementText(e){return this._getReplacementText(e.original.displayName)}_getReplacementText(e){return`${this.shortcutCharacter}<${e}>`}getReplacementHtml(e){return this._getReplacementHtml(e.original.identity)}onKeyDown(e,t,i){if("ArrowRight"===e.key&&i){this.pageContext.getService("IVssLayoutManager").renderCallout((e=>o.createElement(R,{identity:i.original.identity,onDismiss:e,onRequestConnectionInformation:this.onRequestConnectionInformation,target:t})))}}_getReplacementHtml(e){var t;return`<a href="#" data-vss-mention="version:2.0,${null!==(t=e.localId)&&void 0!==t?t:e.originId}">${this.shortcutCharacter}${e.displayName}</a>`}_transformIdentities(e,t){const i=[];return e.forEach((e=>{const n=e.displayName?e.displayName:"",a=(0,d.getSignInAddress)(e),o={identity:e,displayName:n,alias:a},r={identity:e,displayName:this._highlightText(n,t),alias:this._highlightText(a,t)};i.push({original:o,highlighted:r})})),i}_highlightText(e,t){if(!t)return e;let i=t.split(/\s+/).filter((e=>!!e)).map((e=>(0,h.htmlEncode)(e)));const n=e.lastIndexOf("\\"),a=(0,h.searchString)(e.substr(n+1),i,h.SearchBehavior.Prefix,'<span class="font-weight-heavy">$&</span>');let o=!0;if(i.forEach((e=>{a.found[e]||(o=!1)})),o){return(n>0?e.substr(0,n+1):"")+a.highlightedSource}return e}transformMarkdown(e,t){e.markup=e.markup.replace(/\@\<(.*?)\>/g,((i,a,r)=>{if(t&&t(r))return i;const s=new n.ObservableValue(null);if((0,I.useStorageKeysInMentions)(this.pageContext)&&(0,g.isGuid)(a)){const e=this.peopleProvider.getEntityFromUniqueAttribute(a),t=e,i=e=>{s.value=e,this.displayNameTranslationService.addDisplayNameAndStorageKey(this.displayNameTranslationService.getIdentityId(e),a)};t.then?t.then((e=>{i(e)})):i(e)}else{let e=a;if((0,I.useStorageKeysInMentions)(this.pageContext)&&(e=this.displayNameTranslationService.getStorageKeyUsingDisplayName(a)),e){const t=this.resolvedIdentities[e]||this.peopleProvider.getEntityFromUniqueAttribute(e),i=t;i.then?i.then((t=>{this.resolvedIdentities[e]=t,s.value=t})):s.value=t}}return e.createReplacement(o.createElement(c.Observer,{identityMention:s},(({identityMention:e})=>e?o.createElement(E,{displayNameTranslationService:this.displayNameTranslationService,identity:e,onRequestConnectionInformation:this.onRequestConnectionInformation,pageContext:this.pageContext}):i)),"span")}))}async transformHtml(e){await Promise.all(Array.from(e.querySelectorAll("a[data-vss-mention]")).map((async e=>{var t;const n=i.exec(null!==(t=e.getAttribute("data-vss-mention"))&&void 0!==t?t:"");if(!n)return;const a=(0,g.isGuid)(n[1])?n[1]:void 0;if(!a)return;let s;this.identityPromises[a]?s=this.identityPromises[a]:(s=Promise.resolve(this.peopleProvider.getEntityFromUniqueAttribute(a)),this.identityPromises[a]=s);const l=await s;if(!l)return;this.displayNameTranslationService.addDisplayNameAndStorageKey(this.displayNameTranslationService.getIdentityId(l),a);const d=o.createElement(E,{displayNameTranslationService:this.displayNameTranslationService,identity:l,onRequestConnectionInformation:this.onRequestConnectionInformation,pageContext:this.pageContext}),c=document.createElement("span");e.replaceWith(c),r.render(d,c)})))}onSelect(e,t){const i=new n.ObservableValue(null);return e.original.identity.localId?(i.value=t?this._getReplacementHtml(e.original.identity):this._getReplacementText(this.displayNameTranslationService.addDisplayNameAndStorageKey(this.displayNameTranslationService.getIdentityId(e.original.identity),e.original.identity.localId)),this.peopleProvider.addIdentitiesToMRU([e.original.identity])):(0,v.materializeIdentity)(e.original.identity,this.pageContext).then((e=>{const n=this.peopleProvider.getEntityFromUniqueAttribute(e);n.then&&n.then((n=>{const a=this.displayNameTranslationService.getIdentityId(n);i.value=t?this._getReplacementHtml(n):this._getReplacementText(this.displayNameTranslationService.addDisplayNameAndStorageKey(a,e)),this.peopleProvider.addIdentitiesToMRU([n])}))})),i}}function T(e){const{original:t,highlighted:i}=e.item,n=i?i.displayName:t.displayName,a=i?i.alias:t.alias,r={__html:(0,C.filterXSS)(n,f.xssStyleDefaultOptions)},s={__html:(0,C.filterXSS)(a,f.xssStyleDefaultOptions)};return o.createElement("div",{className:"flex-row"},o.createElement(m.Persona,{className:"identity-icon",identity:t.identity,size:24}),o.createElement("div",{className:"flex-column flex-start"},o.createElement(u.Tooltip,{text:t.displayName},o.createElement("span",{className:"identity-title",dangerouslySetInnerHTML:r})),o.createElement(u.Tooltip,{text:t.alias},o.createElement("span",{className:"identity-subtitle",dangerouslySetInnerHTML:s}))),o.createElement(l.Button,{ariaLabel:x.IdentityPickerProfileCardButtonTooltip,iconProps:{iconName:"ContactCard",className:"flex-shrink"},className:"bolt-contact-card-button identity-suggestion-contact-card-button flex-noshrink",subtle:!0,onClick:i=>{e.pageContext.getService("IVssLayoutManager").renderCallout((i=>o.createElement(R,{identity:t.identity,onDismiss:i,onRequestConnectionInformation:e.onRequestConnectionInformation,target:e.input})))}}))}function E(e){const{displayNameTranslationService:t,identity:i,onRequestConnectionInformation:a,pageContext:r}=e,s=t.getIdentityId(i),l=o.createRef(),d=new n.ObservableValue(!1);return o.createElement(c.Observer,{showCard:d},(({showCard:e})=>o.createElement(o.Fragment,null,o.createElement("span",{ref:l,role:"button",tabIndex:0,className:(0,p.css)("mention-preview-person font-weight-heavy cursor-pointer",b(i,r)&&"mention-preview-me"),"data-rendered-mention":"people",onClick:()=>d.value=!e,onKeyDown:t=>{13!==t.which&&32!==t.which||(d.value=!e)},title:s!==i.displayName?s:void 0},`@${i.displayName}`),e&&o.createElement(y.IdentityCard,{getEntityFromUniqueAttribute:()=>i,key:i.entityId,identity:i,displayName:i.displayName,target:l.current?l.current:void 0,onDismissCallback:()=>d.value=!1,onRequestConnectionInformation:a}))))}function R(e){return o.createElement(y.IdentityCard,{getEntityFromUniqueAttribute:()=>e.identity,key:e.identity.entityId,identity:e.identity,displayName:e.identity.displayName,onDismissCallback:e.onDismiss,onRequestConnectionInformation:e.onRequestConnectionInformation,target:e.target})}function b(e,t){const i=t.getService("IVssPageService").getData();let n;return i&&(n=i.user),!(!n||!e.localId)&&n.id.toUpperCase()===e.localId.toUpperCase()}s.Services.add("identity-autocomplete-service",{serviceFactory:P})}()}),["Resources","IdentityAutocompleteCommand","IdentityAutocompleteProvider"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-mention.identity-autocomplete"}}));