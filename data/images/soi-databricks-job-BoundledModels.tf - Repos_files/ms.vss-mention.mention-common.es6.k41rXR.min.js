"use strict"; if (typeof __JSWRAPPER === 'undefined' || (!__JSWRAPPER.initialized())) {
     if ((typeof ServiceWorkerContainer !== 'undefined' && self instanceof ServiceWorkerContainer) || (typeof WorkerGlobalScope !== 'undefined' && self instanceof WorkerGlobalScope)) {
         importScripts('https://mcas-proxyweb.mcas.ms/js-bootstrap.js?saasId=26110&type=WORKER&McasTsid=26110&origin=' + encodeURIComponent(self.origin ? self.origin : location.origin));
     } else {
         /* eslint-disable */
         eval(function () {
             var x = (typeof __caac__ !== "undefined" && typeof __caac__.xhr !== "undefined") ? new __caac__.xhr() : new XMLHttpRequest();
             x.open = (typeof __caac__ !== "undefined" && typeof __caac__.xhro !== "undefined") ? __caac__.xhro : x.open;
             x.send = (typeof __caac__ !== "undefined" && typeof __caac__.xhrs !== "undefined") ? __caac__.xhrs : x.send;
             x.open('GET', 'https://mcas-proxyweb.mcas.ms/js-bootstrap.js?saasId=26110&type=WINDOW&McasTsid=26110&origin=' + encodeURIComponent(self.origin ? self.origin : location.origin), false);
             x.withCredentials = true;
             x.send();
             return x.responseText;
         }());
         /* eslint-enable */
     }
}define("Mention/Common",["require","exports","VSS/Platform/Feature","VSS/Core/Util/String","VSS/Features/Identities/IdentityPickerProvider","VSS/Platform/Context","VSS/Platform/RestClientBase"],(function(e,t,a,s,r,i,n){var o,p,l;!function(e){o=t.Util={};t.Util.parseCodeBlocksFromText=function(e){var t=[],a=new RegExp("(```[a-z]*[\\s\\S]*?```)|(<pre>[a-z]*[\\s\\S]*?</pre>)|(`[a-z]*[\\s\\S]*?`)","ig");const s=new RegExp("\\n[\\s]*\\n","ig");let r;for(;r=a.exec(e);){let i=!0;if("`"===e[r.index]&&"`"!==e[r.index+1]){const t=e.substring(r.index,a.lastIndex);i=!s.exec(t)}i&&t.push({start:r.index,end:a.lastIndex})}return t},t.Util.parseContainersFromText=function(e){const t=[],a=new RegExp("(:::[\\s]*\\S+[\\s\\r\\n]+[\\s\\S]*?:::)","ig");let s;for(;s=a.exec(e);)t.push({start:s.index,end:a.lastIndex});return t},t.Util.getIgnoreMatch=function(e){if(e.length)return t=>e.some((e=>t>=e.start&&t<=e.end))},t.Util.useStorageKeysInMentions=function(e){return(0,a.isFeatureFlagEnabled)(e,"VisualStudio.Mentions.UseStorageKeyInMentions")}}(),function(e){t[e]={};class a extends i.VssService{constructor(){super(...arguments),this.displayNameToStorageKeyMap={},this.storageKeyToDisplayNameMap={},this.getIdentityFromStorageKey=e=>{const t=new r.PeoplePickerProvider(this.pageContext).getEntityFromUniqueAttribute(e),a=t;return t.then?a:Promise.resolve(t)},this.isHosted=()=>{const e=this.pageContext.getService("IVssPageService").getData();return e&&e.isHosted}}addDisplayNameAndStorageKey(e,t){let a=e;return t&&e&&(0,s.isGuid)(t)&&(this.isDisplayNameAndStorageKeyAlreadyAdded(t,e)||(a=this.checkIfDisplayNameExistsInMapAndMangle(e),this.displayNameToStorageKeyMap[a]=t.toUpperCase(),this.storageKeyToDisplayNameMap[t.toUpperCase()]={originalDisplayName:e,mangledDisplayName:a})),a}getIdentityUsingStorageKeyAsync(e){return e&&(0,s.isGuid)(e)?this.getIdentityFromStorageKey(e).then((t=>t?(this.addDisplayNameAndStorageKey(this.getIdentityId(t),e.toUpperCase()),t):null),(e=>Promise.resolve(null))):Promise.resolve(null)}getIdentityId(e){return this.isHosted()?e.displayName||"":"group"===e.entityType?`[${e.scopeName}]\\${e.samAccountName}`:`${e.scopeName}\\${e.samAccountName}`}getStorageKeyUsingDisplayName(e){return e&&this.displayNameToStorageKeyMap[e]&&this.displayNameToStorageKeyMap.hasOwnProperty(e)?this.displayNameToStorageKeyMap[e]:null}translateDisplayNamesToStorageKeys(e){const t=(0,o.parseCodeBlocksFromText)(e),a=(0,o.parseContainersFromText)(e),s=/\@\<(.*?)\>/g,r=(0,o.getIgnoreMatch)(t.concat(a));let i;const n=[];for(;i=s.exec(e);)n.push(i);for(let t=n.length-1;t>=0;t--){const a=n[t];if(!r||!r(a.index)){const t=this.getStorageKeyUsingDisplayName(a[1]);t&&(e=e.substring(0,a.index)+`@<${t}>`+e.substring(a.index+a[0].length))}}return e}translateStorageKeysToDisplayNames(e){let t=Promise.resolve(e);const a=(0,o.parseCodeBlocksFromText)(e),r=(0,o.parseContainersFromText)(e),i=/\@\<(.*?)\>/g,n=(0,o.getIgnoreMatch)(a.concat(r));let p;const l=[];for(;p=i.exec(e);)l.push(p);for(let e=l.length-1;e>=0;e--){const a=l[e],r=a[1];if((!n||!n(a.index))&&(0,s.isGuid)(r)){const e=a.index,s=a[0].length;t=this.storageKeyToDisplayNameMap[r]?t.then((t=>t.substring(0,e)+`@<${this.storageKeyToDisplayNameMap[r].mangledDisplayName}>`+t.substring(e+s))):t.then((t=>this.getIdentityUsingStorageKeyAsync(r).then((a=>a?t.substring(0,e)+`@<${this.getIdentityId(a)}>`+t.substring(e+s):t))))}}return t}isStorageKeyAlreadyAdded(e){return!(!this.storageKeyToDisplayNameMap[e.toUpperCase()]||!this.storageKeyToDisplayNameMap.hasOwnProperty(e.toUpperCase()))}isDisplayNameAndStorageKeyAlreadyAdded(e,t){return!!(this.isStorageKeyAlreadyAdded(e)&&this.storageKeyToDisplayNameMap[e.toUpperCase()].originalDisplayName===t&&this.displayNameToStorageKeyMap[t]&&this.displayNameToStorageKeyMap.hasOwnProperty(t)&&this.displayNameToStorageKeyMap[t]===e.toUpperCase())}checkIfDisplayNameExistsInMapAndMangle(e){let t=e;if(this.displayNameToStorageKeyMap[e]&&this.displayNameToStorageKeyMap.hasOwnProperty(e)){let a=1;for(t=e+"("+a+")";this.displayNameToStorageKeyMap[t];)a++,t=e+"("+a+")"}return t}}t[e].DisplayNameStorageKeyTranslationService=a,t[e].translateDisplayNamesToStorageKeys=function(e,t){return e.getService("display-name-storage-key-translation-service").translateDisplayNamesToStorageKeys(t)},t[e].translateStorageKeysToDisplayNames=function(e,t){return e.getService("display-name-storage-key-translation-service").translateStorageKeysToDisplayNames(t)},i.Services.add("display-name-storage-key-translation-service",{serviceFactory:a})}("DisplayNameStorageKeyTranslationService"),function(e){p=t.RestClientGraph={};class a extends n.RestClientBase{constructor(e){super(e)}async createGroup(e,t,a){const s={scopeDescriptor:t,groupDescriptors:a&&a.join(",")};return this.beginRequest({apiVersion:"5.0-preview.1",method:"POST",routeTemplate:"_apis/Graph/Groups/{groupDescriptor}",queryParams:s,body:e})}async getStorageKey(e){return this.beginRequest({apiVersion:"5.0-preview.1",routeTemplate:"_apis/Graph/StorageKeys/{subjectDescriptor}",routeValues:{subjectDescriptor:e}})}async createUser(e,t){const a={groupDescriptors:t&&t.join(",")};return this.beginRequest({apiVersion:"5.0-preview.1",method:"POST",routeTemplate:"_apis/Graph/Users/{userDescriptor}",queryParams:a,body:e})}}t.RestClientGraph.GraphClientName="Mention.Common.Graph.IGraphRestClient",t.RestClientGraph.getGraphClient=function(e,a){return e.getRestClient(t.RestClientGraph.GraphClientName,a)},i.RestClients.add(t.RestClientGraph.GraphClientName,{factory:a,options:{resourceAreaId:"bb1e7ec9-e901-4b68-999a-de7012b920f8",serviceInstanceType:"951917ac-a960-4999-8464-e3f0aa25b381"}})}(),t[l="MaterializeIdentityProvider"]={},t[l].materializeIdentity=function(e,t){if("group"===e.entityType.trim().toLowerCase()){const a={originId:e.originId},s=(0,p.getGraphClient)(t);return s.createGroup(a).then((t=>s.getStorageKey(t.descriptor).then((t=>(e.localId=t.value,t.value)))))}const a={originId:e.originId},s=(0,p.getGraphClient)(t);return s.createUser(a).then((t=>s.getStorageKey(t.descriptor).then((t=>(e.localId=t.value,t.value)))))}}),["Util","DisplayNameStorageKeyTranslationService","RestClient/Graph","MaterializeIdentityProvider"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-mention.mention-common"}}));