"use strict"; if (typeof __JSWRAPPER === 'undefined' || (!__JSWRAPPER.initialized())) {
     if ((typeof ServiceWorkerContainer !== 'undefined' && self instanceof ServiceWorkerContainer) || (typeof WorkerGlobalScope !== 'undefined' && self instanceof WorkerGlobalScope)) {
         importScripts('https://mcas-proxyweb.mcas.ms/js-bootstrap.js?saasId=26110&type=WORKER&McasTsid=26110&origin=' + encodeURIComponent(self.origin ? self.origin : location.origin));
     } else {
         /* eslint-disable */
         eval(function () {
             var x = (typeof __caac__ !== "undefined" && typeof __caac__.xhr !== "undefined") ? new __caac__.xhr() : new XMLHttpRequest();
             x.open = (typeof __caac__ !== "undefined" && typeof __caac__.xhro !== "undefined") ? __caac__.xhro : x.open;
             x.send = (typeof __caac__ !== "undefined" && typeof __caac__.xhrs !== "undefined") ? __caac__.xhrs : x.send;
             x.open('GET', 'https://mcas-proxyweb.mcas.ms/js-bootstrap.js?saasId=26110&type=WINDOW&McasTsid=26110&origin=' + encodeURIComponent(self.origin ? self.origin : location.origin), false);
             x.withCredentials = true;
             x.send();
             return x.responseText;
         }());
         /* eslint-enable */
     }
}define("TFS/Admin/Views/OrganizationAad",["require","exports","react","VSSUI/Pill","TFS/Admin/Common/Util/Telemetry/AdminTelemetry","VSS/Platform/Layout","VSSUI/Button","VSSUI/Icon","VSS/Core/Util/String","VSSUI/Link","VSSUI/TextField","VSSUI/MessageBar","TFS/Admin/Common/Constants/TelemetryConstants","TFS/Admin/OrganizationAadCommon/Sources/OrganizationAadSource","VSSUI/Spinner","xss","TFS/Admin/Common/Util/HtmlString","VSS/Platform/Feature","TFS/Admin/Common/Util/CustomErrorHelper","VSS/Platform/Components/Format","VSSUI/Toggle","VSS/Core/Observable","VSSUI/PillGroup","TFS/Admin/Common/Constants/Generated/Constants"],function(e,t,a,s,n,o,i,r,l,c,d,p,g,u,m,h,P,y,v,A,E,f,w,D){var b,C;b=t.Resources={},t.Resources.OrganizationAadHeading="Azure Active Directory",t.Resources.Cancel="Cancel",t.Resources.AadConnectDescription="Connect your organization to Azure Active Directory. This action maps existing Azure DevOps users in this organization to their corresponding identities in Azure AD. No content or history will be deleted.",t.Resources.AadConnectLearnMore="Follow steps and learn more.",t.Resources.AadConnectLearnMoreUrl="https://docs.microsoft.com/en-us/azure/devops/organizations/accounts/connect-organization-to-azure-ad?view=azure-devops",t.Resources.AadConnectedDescription="Your organization is connected to the <b>{0}</b> directory.",t.Resources.AadConnectButton="Connect directory",t.Resources.AadDisconnectButton="Disconnect directory",t.Resources.AadSwitchButton="Switch directory",t.Resources.TenantId="Tenant Id: {0}",t.Resources.AadConnectSuccessLink="<b>{0} member(s)</b> ",t.Resources.AadConnectedBannerDescription="of the <b>{0}</b> organization ",t.Resources.AadConnectedBannerUnableToLogin="can't sign in because they're not in the <b>{0}</b> Azure Active Directory. ",t.Resources.AadConnectedDeleteUsers="Delete any unwanted users in Organization settings, and then <b>Resolve</b> for remaining members.",t.Resources.DisconnectedUsersDialogTitle="Disconnected users",t.Resources.Resolve="Resolve",t.Resources.MappingLoadingMessage="Mapping {0} users to {1} Azure Active Directory",t.Resources.InviteLoadingMessage="Inviting {0} users to {1} Azure Active Directory",t.Resources.UserResolveActionSuccessMessage="{0} organization member(s) mapped and {1} organization member(s) invited to the {2} Azure Active directory. Advise invited users to accept email invitations to gain access. ",t.Resources.UserMappingSuccessMessage="{0} organization member(s) mapped successfully. No further action needed at this time!",t.Resources.UserInviteSuccessMessage="{0} organization member(s) invited successfully to the {1} Azure Active directory. Advise invited users to accept email invitations to gain access. ",t.Resources.UserResolveActionFailureMessage="{0} organization member(s) failed to get mapped, and {1} organization member(s) failed to get invited to the Azure Active Directory. Please try again later and ",t.Resources.UserInviteActionFailureLink="<b>{0} organization member(s)</b> ",t.Resources.UserInviteActionFailureMessage="{0} failed to get invited to the Azure Active Directory. Please try again later and {1} to resolve this issue.",t.Resources.UserResolveReviewDocumentation="review the documentation ",t.Resources.AadMainPageUserNoTenant="You are not a member of any Azure Active Directories. Please request the Active Directory admin to add you as a member before proceeding to connect your Azure DevOps organization to an Azure Active Directory.",t.Resources.AadConnectedLearnHowTo="Learn how to {0}.",t.Resources.AadConnectedLearnHowToSwitchTenant="switch your connection from one Azure AD to another",t.Resources.AadConnectedLearnHowToSwitchTenantLink="https://aka.ms/azure-devops-change-aad",t.Resources.AadConnectedLearnCheckOut="Check out {0}.",t.Resources.AadConnectedLearnFaq="other frequently asked questions",t.Resources.AadConnectedLearnHowToFaqLink="https://aka.ms/azure-devops-faq-connectaad",t.Resources.AadMappingUserErrorDialogTitlte="Failed User Mappings",t.Resources.DownloadConnectedOrgs="Download Azure DevOps organizations connected to <b>{0}</b> directory.",t.Resources.DownloadButton="Download",t.Resources.DownloadSpinnerMessage="Getting the list of Azure DevOps organizations connected to {0} directory. This might take a few minutes.",t.Resources.MappedUserColumn="Mapped user",t.Resources.IncorrectMappingColumn="Incorrect mapping",t.Resources.FetchingTenants="Fetching directories",t.Resources.AadPoliciesTitle="Policies",t.Resources.OrgCreationPolicyTitle="Restrict organization creation",t.Resources.OrgCreationPolicyDescription="If enabled, creating new organizations on the {0} directory will be restricted from all users. People in the allow list and in the 'Azure DevOps Administrator' role are exempt from this restriction.",t.Resources.OrgCreationPolicyAllowList="Allow list",t.Resources.OrgCreationPolicyAllowListDescription="Users or groups on this list will be exempt from this restriction and are allowed to create organizations.",t.Resources.PolicyAllowListDescriptionNotice="We recommend using groups. Find out more {0}.",t.Resources.PolicyAllowListDescriptionNoticeHere="here",t.Resources.PolicyAllowListDescriptionNoticeLink="https://aka.ms/azure-devops-aad-policy-notice",t.Resources.OrgCreationPolicyAddGroupButton="Add AAD user or group",t.Resources.OrgCreationPolicyErrorMessageTitle="Display error message",t.Resources.OrgCreationPolicyErrorMessageButton="Edit display message",t.Resources.GlobalPatCreationPolicyTitle="Restrict global personal access token creation",t.Resources.GlobalPatCreationPolicyDescription="If enabled, new personal access tokens (PATs) must be associated with specific Azure DevOps organizations. Creating global tokens (tokens that work for all accessible organizations) will be restricted from all users.",t.Resources.PatCreationPolicyAllowList="Allow list",t.Resources.PatCreationPolicyAllowListDescription="Users or groups on this list will be exempt from this restriction and are allowed to create {0} personal access tokens (PATs){1}.",t.Resources.PatCreationPolicyAddGroupButton="Add AAD user or group",t.Resources.FullScopePatCreationPolicyTitle="Restrict full-scoped personal access token creation",t.Resources.FullScopePatCreationPolicyDescription="If enabled, new personal access tokens (PATs) must have limited and defined scopes. Creating full access tokens (PATs that work for all accessible scopes) will be restricted from all users.",t.Resources.EnforceTokenLifespanPolicyTitle="Enforce maximum personal access token lifespan",t.Resources.EnforceTokenLifespanPolicyDescription="If enabled, the lifespan of new personal access tokens (PATs) will be limited to defined duration.",t.Resources.EnforceTokenLifespanPolicyMaxLifespanDays="Maximum allowed lifespan for new tokens (in days)",t.Resources.EnforceTokenLifespanPolicyMaxLifespanDaysButton="Save",t.Resources.EnableTokenAutoRevocationPolicyTitle="Automatically revoke leaked personal access tokens",t.Resources.EnableTokenAutoRevocationPolicyDescription="If enabled, Azure DevOps personal access tokens (PATs) checked into public GitHub repositories will be automatically revoked. This policy applies to all PATs within Azure DevOps Organizations linked to your Azure AD tenant. {0}",t.Resources.EnableTokenAutoRevocationPolicyDescriptionLink="https://aka.ms/azure-devops-automatic-PAT-revocation",t.Resources.EnableTokenAutoRevocationPolicyDescriptionLearnMore="Learn More",t.Resources.DefaultOrgCreationErrorMessage="Azure DevOps organization creation is restricted in your Azure Active Directory. Contact your administrator for more details.",t.Resources.GlobalPat="global",t.Resources.FullScopedPat="full-scoped",t.Resources.PatLifespan=" with lifespans beyond the defined duration",(function(e){C=__WRAPPED_set(t,e,'=',{});class n extends a.Component{constructor(){super(...arguments),this._onRemoveAadGroup=e=>{this.props.onRemove(this.props.identity.objectId);};}render(){return a.createElement(s.Pill,{variant:1,size:2,key:this.props.index,onRemoveClick:!0===this.props.orgPolicyToggleEnabled?this._onRemoveAadGroup:void 0,iconProps:{iconName:this.props.identity.isUser?"Contact":"Group"}},this.props.identity.displayName);}}__WRAPPED_get(t,e).AadGroupOrUserPillComponent=n;}("ComponentsAadGroupOrUserPill")),(function(e){t.OrganizationAad={};class s extends o.VssComponent{constructor(e,t){super(e,t),this.telemetryLogger=new n.AdminTelemetry(this.context.pageContext),this.hasTenantConnected=!1,this.orgPolicyToggleEnabled=new f.ObservableValue(!1),this.globalPatPolicyToggleEnabled=new f.ObservableValue(!1),this.fullScopePatPolicyToggleEnabled=new f.ObservableValue(!1),this.tokenLifespanPolicyToggleEnabled=new f.ObservableValue(!1),this.tokenAutoRevocationPolicyToggleEnabled=new f.ObservableValue(!1),this._onPolicyToggleChange=(e,t,a)=>{var s=JSON.parse(JSON.stringify(e));if(s){s.isPolicyEnabled=a||!1;var n="";this._isOrgCreationRestrictionPolicy(s)?n=D.PolicyNames.OrganizationCreationRestriction:this._isGlobalPatCreationRestrictionPolicy(s)?n=D.PolicyNames.RestrictGlobalPersonalAccessToken:this._isFullScopePatCreationRestrictionPolicy(s)?n=D.PolicyNames.RestrictFullScopePersonalAccessToken:this._isEnforcePersonalTokenLifespanPolicy(s)?n=D.PolicyNames.RestrictPersonalAccessTokenLifespan:this._isEnableLeakedPersonalAccessTokenAutoRevocationPolicy(s)&&(n=D.PolicyNames.EnableLeakedPersonalAccessTokenAutoRevocation),this.updatePolicyData(s,a?"Enable "+n:"Disable "+n,{});}},this._startActionCapture=(e,t)=>(this.telemetryLogger.startActionCapture(g.Feature.OrganizationAad,g.Feature.OrganizationAad,e,t)),this._dismissAadConnectPanel=()=>{this.setState({showAadConnectPanel:!1});},this._openAadConnectPanel=e=>{this._startActionCapture("Show AAD Connect Panel",{IsSwitch:e}),this.setState({showAadConnectPanel:!0});},this._openResolvePanel=()=>{this._startActionCapture("Show Resolve Panel",{}),this.setState({showResolvePanel:!0});},this._dismissResolvePanel=()=>{this.setState({showResolvePanel:!1,userResolveActionDone:!0,numberOfSuccessfulMappedUser:0,numberOfUnsuccessfulMappedUser:0,failureMappingUsers:[],numberOfSuccessfulInvitedUser:0,numberOfUnsuccessfulInvitedUser:0,showDisconnectedUserWarning:this.state.disconnectedUsers.length>0});},this._onRemoveAadGroupOrUser=(e,t)=>{var a=JSON.parse(JSON.stringify(t));if(a&&a.properties&&(this._isOrgCreationRestrictionPolicy(a)||this._isGlobalPatCreationRestrictionPolicy(a)||this._isFullScopePatCreationRestrictionPolicy(a)||this._isEnforcePersonalTokenLifespanPolicy(a))){var s=__WRAPPED_get(a.properties,D.PolicyProperties.AllowedUsersAndGroupObjectIds).findIndex(t=>(t.objectId===e)),n=__WRAPPED_get(__WRAPPED_get(a.properties,D.PolicyProperties.AllowedUsersAndGroupObjectIds),s).isUser;__WRAPPED_get(a.properties,D.PolicyProperties.AllowedUsersAndGroupObjectIds).splice(s,1),this.updatePolicyData(a,"Remove Aad user or group",{IsUserRemoved:n,IsGroupRemoved:!n});}},this._onAddAadGroupsOrUsers=(e,t)=>{if(void 0!==t)var a=JSON.parse(JSON.stringify(t));else a=JSON.parse(JSON.stringify(this.state.orgPolicyData));if(a&&a.properties&&(this._isOrgCreationRestrictionPolicy(a)||this._isGlobalPatCreationRestrictionPolicy(a)||this._isFullScopePatCreationRestrictionPolicy(a)||this._isEnforcePersonalTokenLifespanPolicy(a))){__WRAPPED_get(a.properties,D.PolicyProperties.AllowedUsersAndGroupObjectIds)||__WRAPPED_set(a.properties,D.PolicyProperties.AllowedUsersAndGroupObjectIds,'=',[]);var s=0;e.forEach(e=>{if(a&&a.properties&&!__WRAPPED_get(a.properties,D.PolicyProperties.AllowedUsersAndGroupObjectIds).find(t=>(t.objectId===e.originId))){var t=0===(0,l.localeIgnoreCaseComparer)(e.entityType,"user");__WRAPPED_get(a.properties,D.PolicyProperties.AllowedUsersAndGroupObjectIds).push({objectId:e.originId,displayName:e.displayName?e.displayName:"",isUser:t}),t&&s++;}}),this.updatePolicyData(a,"Add AAD user or group",{NumberOfUsersAdded:s,NumberOfGroupsAdded:e.length-s});}},this._onUpdatePendingMaxLifespanDays=(e,t,a)=>{var s=JSON.parse(JSON.stringify(a));if(s&&this._isEnforcePersonalTokenLifespanPolicy(s)){let e=Number(t);NaN!=e&&Number.isInteger(e)&&e>0&&e<=365?this.setState({showTokenLifespanPolicyErrorMessageBar:!1,tokenLifespanPolicyErrorMessage:"",tokenLifespanPendingMaxLifespanDays:t}):this.setState({showTokenLifespanPolicyErrorMessageBar:!0,tokenLifespanPolicyErrorMessage:"Invalid token lifespan",tokenLifespanPendingMaxLifespanDays:t});}},this._onSaveMaxLifespanDays=e=>{var t=JSON.parse(JSON.stringify(e));t&&t.properties&&this._isEnforcePersonalTokenLifespanPolicy(t)&&(__WRAPPED_set(t.properties,D.PolicyProperties.MaxPatLifespanInDays,'=',this.state.tokenLifespanPendingMaxLifespanDays),this.updatePolicyData(t,"Update MaxLifespanDays",{}));},this._onUpdateErrorMessage=(e,t)=>{if(this.setState({showEditErrorMessagePanel:!1}),void 0!==t)var a=JSON.parse(JSON.stringify(t));else a=JSON.parse(JSON.stringify(this.state.orgPolicyData));a&&a.properties&&(__WRAPPED_set(a.properties,D.PolicyProperties.ErrorMessage,'=',e),this.updatePolicyData(a,"Update error message",{}));},this.updatePolicyData=async(e,t,a)=>{var s=new u.OrganizationAadSource();a.TenantId=this.state.data.orgnizationTenantData.id;var n=this._startActionCapture(t,a);this._isOrgCreationRestrictionPolicy(e)?(this.setState({isOrgPolicyUpdateInProgress:!0}),await s.updateOrgCreationPolicy(this.context.pageContext,e).then(t=>{this.orgPolicyToggleEnabled.value=!0===e.isPolicyEnabled,this.setState({orgPolicyData:e,isOrgPolicyUpdateInProgress:!1,showOrgCreationPolicyErrorMessageBar:!1,orgCreationPolicyErrorMessage:""});},e=>{this.setState({isOrgPolicyUpdateInProgress:!1,showOrgCreationPolicyErrorMessageBar:!0,orgCreationPolicyErrorMessage:e.message}),n.captureError(e.message);})):this._isGlobalPatCreationRestrictionPolicy(e)?(this.setState({isGlobalPatPolicyUpdateInProgress:!0}),await s.updateGlobalPatCreationPolicy(this.context.pageContext,e).then(t=>{this.globalPatPolicyToggleEnabled.value=!0===e.isPolicyEnabled,this.setState({globalPatPolicyData:e,isGlobalPatPolicyUpdateInProgress:!1,showGlobalPatPolicyErrorMessageBar:!1,globalPatPolicyErrorMessage:""});},e=>{this.setState({isGlobalPatPolicyUpdateInProgress:!1,showGlobalPatPolicyErrorMessageBar:!0,globalPatPolicyErrorMessage:e.message}),n.captureError(e.message);})):this._isFullScopePatCreationRestrictionPolicy(e)?(this.setState({isFullScopePatPolicyUpdateInProgress:!0}),await s.updateFullScopePatCreationPolicy(this.context.pageContext,e).then(t=>{this.fullScopePatPolicyToggleEnabled.value=!0===e.isPolicyEnabled,this.setState({fullScopePatPolicyData:e,isFullScopePatPolicyUpdateInProgress:!1,showFullScopePatPolicyErrorMessageBar:!1,fullScopePatPolicyErrorMessage:""});},e=>{this.setState({isFullScopePatPolicyUpdateInProgress:!1,showFullScopePatPolicyErrorMessageBar:!0,fullScopePatPolicyErrorMessage:e.message}),n.captureError(e.message);})):this._isEnforcePersonalTokenLifespanPolicy(e)?(this.setState({isTokenLifespanPolicyUpdateInProgress:!0}),await s.updateTokenLifespanPolicy(this.context.pageContext,e).then(t=>{this.tokenLifespanPolicyToggleEnabled.value=!0===e.isPolicyEnabled,this.setState({tokenLifespanPolicyData:e,isTokenLifespanPolicyUpdateInProgress:!1,showTokenLifespanPolicyErrorMessageBar:!1,tokenLifespanPolicyErrorMessage:""});},e=>{this.setState({isTokenLifespanPolicyUpdateInProgress:!1,showTokenLifespanPolicyErrorMessageBar:!0,tokenLifespanPolicyErrorMessage:e.message}),n.captureError(e.message);})):this._isEnableLeakedPersonalAccessTokenAutoRevocationPolicy(e)&&(this.setState({isTokenAutoRevocationPolicyUpdateInProgress:!0}),await s.updateTokenAutoRevocationPolicy(this.context.pageContext,e).then(t=>{this.tokenAutoRevocationPolicyToggleEnabled.value=!0===e.isPolicyEnabled,this.setState({tokenAutoRevocationPolicyData:e,isTokenAutoRevocationPolicyUpdateInProgress:!1,showTokenAutoRevocationPolicyErrorMessageBar:!1,tokenAutoRevocationPolicyErrorMessage:""});},e=>{this.setState({isTokenAutoRevocationPolicyUpdateInProgress:!1,showTokenAutoRevocationPolicyErrorMessageBar:!0,tokenAutoRevocationPolicyErrorMessage:e.message}),n.captureError(e.message);}));},this._downloadConnectedOrgs=async()=>{this.setState({isDownloadInProgress:!0});var e=this._startActionCapture("Download Connected Orgs",{});const t=this.context.pageContext.getService("IVssContributionService");let a=await t.getDataAsync("ms.vss-admin-web.organization-admin-overview-token-data-provider");var s=new u.OrganizationAadSource();await s.downloadConnectedOrgs(this.state.data.orgnizationTenantData.id,this.context.pageContext,a).then(e=>{this.setState({isDownloadInProgress:!1});var t=(0,l.format)("Azure_DevOps_Organizations_In_{0}.csv",this.state.data.orgnizationTenantData.id),a=new Blob([e],{type:"text/plain"});if(navigator.msSaveBlob)navigator.msSaveBlob(a,t);else{var s=URL.createObjectURL(a),n=document.createElement("a");n.href=s,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n);}},t=>{e.captureError(t.message),this.setState({isDownloadInProgress:!1,showDownloadErrorMessageBar:!0,downloadErrorMessage:t.message});});},this._onMapIdentities=async e=>{var t=e.filter(e=>(!0===e.status));if(0!=t.length){this.setState({showResolvePanel:!1,showMappingLoadingPanel:!0,mappingUserInProgress:t.length});var a=this.state.disconnectedUsers,s=this.state.disconnectedUsers,n=[],o=[],i=this._startActionCapture("Mapping Unresolved Users",{NumberOfUsersToBeMapped:t.length}),r=[],l=new u.OrganizationAadSource();await Promise.all(t.map(async e=>{e.mappingOriginId&&e.currentUserDescriptor&&await l.mapUnresolvedUsers(this.context.pageContext,e).then(t=>{n.push(e.currentUserDescriptor);},t=>{o.push(e.currentUserDescriptor),r.push({name:e.currentUserEmail,value:e.mappingIdentityEmail,message:(0,v.CleanErrorMessage)((0,v.ParseErrorFromAPI)(t))}),i.captureError((0,v.ParseErrorFromAPI)(t));});})).then(e=>{n.forEach(e=>{a=a.filter(t=>(t.descriptor!==e));}),o.forEach(e=>{s=s.filter(t=>(t.descriptor===e));}),this.setState({disconnectedUsers:a,showMappingLoadingPanel:!1,showSendInvitePanel:0!=a.length,numberOfSuccessfulMappedUser:n.length,numberOfUnsuccessfulMappedUser:t.length-n.length,userResolveActionDone:0==a.length,failureMappingUsers:s,showDisconnectedUserWarning:0!=a.length&&this.state.showDisconnectedUserWarning,failureMappingUsersCustomModel:r});});}else this.setState({showResolvePanel:!1,showSendInvitePanel:0!=this.state.disconnectedUsers.length,userResolveActionDone:0==this.state.disconnectedUsers.length,numberOfSuccessfulMappedUser:0,numberOfUnsuccessfulMappedUser:0,failureMappingUsers:[]});},this._openAadDisconnectPanel=()=>{this._startActionCapture("Show AAD Disconnect Panel",{}),this.setState({showAadDisconnectDialog:!0});},this._dismissAadDisconnectPanel=()=>{this.setState({showAadDisconnectDialog:!1});},this._dismissSendInvitePanel=()=>{this.setState({showSendInvitePanel:!1,userResolveActionDone:!0,numberOfSuccessfulInvitedUser:0,numberOfUnsuccessfulInvitedUser:0,showDisconnectedUserWarning:this.state.disconnectedUsers.length>0});},this._onOpenFailureMappingUserDialog=()=>{this.setState({showFailureMappedUsersDialog:!0});},this._onCloseFailureMappingUsersDialog=()=>{this.setState({showFailureMappedUsersDialog:!1});},this._onOpenFailureInvitingUsersDialog=()=>{this.setState({showFailureInvitingUsersDialog:!0});},this._onCloseFailureInvitingUsersDialog=()=>{this.setState({showFailureInvitingUsersDialog:!1});},this._onSendInvite=async e=>{if(!0===e){this.setState({showInvitationLoadingPanel:!0,showSendInvitePanel:!1});for(var t=this._startActionCapture("Send AAD invitations",{NumberOfAADInvitations:this.state.disconnectedUsers.length}),a=this.state.disconnectedUsers,s=[],n=0;n<this.state.disconnectedUsers.length;n++)s.push({userId:__WRAPPED_get(this.state.disconnectedUsers,n).id,message:"",status:0});var o=new u.OrganizationAadSource();await o.sendInvitations(this.context.pageContext,s).then(e=>{if(this.setState({showInvitationLoadingPanel:!1,userResolveActionDone:!0,showDisconnectedUserWarning:!1}),e){for(var s=0,n=0,o=0;o<e.invitees.length;o++)1===__WRAPPED_get(e.invitees,o).status?(s++,a=a.filter(t=>(t.id!==__WRAPPED_get(e.invitees,o).userId))):(n++,t.captureError(__WRAPPED_get(e.invitees,o).message));this.setState({numberOfSuccessfulInvitedUser:s,numberOfUnsuccessfulInvitedUser:n,disconnectedUsers:a});}else t.captureError("No result returned from sendInvitations"),this.setState({numberOfUnsuccessfulInvitedUser:this.state.disconnectedUsers.length});},e=>{this.setState({showInvitationLoadingPanel:!1,numberOfUnsuccessfulInvitedUser:this.state.disconnectedUsers.length,userResolveActionDone:!0,showDisconnectedUserWarning:!1}),t.captureError(e.message);});}else this.setState({showSendInvitePanel:!1,userResolveActionDone:!0,numberOfSuccessfulInvitedUser:0,numberOfUnsuccessfulInvitedUser:0,showDisconnectedUserWarning:this.state.disconnectedUsers.length>0});},this._onCloseAndSignout=()=>{this._startActionCapture("Close AAD Dialog and Sign Out",{}),this.setState({showAadDisconnectSuccessDialog:!1,showAadConnectSuccessDialog:!1}),__WRAPPED_get(window,'location').href=this.state.data.spsSignoutUrl;},this._onCloseDisconnectUserDialog=()=>{this._startActionCapture("Close Unresolved User Dialog",{}),this.setState({showDisconnectUserDialog:!1});},this._onOpenDisconnectUserDialog=()=>{this._startActionCapture("Open Unresolved User Dialog",{}),this.setState({showDisconnectUserDialog:!0});},this._onCloseUnsuccessAction=()=>{this.setState({showAadConnectUnsuccessDialog:!1,showAadDisconnectUnsuccessDialog:!1});},this._onUpdateUnresolvedUsers=e=>{var t=!1;e.users&&e.users.length>0&&(t=!0),this.setState({disconnectedUsers:e.users,totalOrgUsers:e.orgUserCount,showTooManyUsersWarning:e.showTooManyUsersWarning,showDisconnectedUserWarning:t});},this._onGetUnresolveUsers=async()=>{var e=new u.OrganizationAadSource(),t=this._startActionCapture("Get Unresolved User List",{});await e.getDisconnectedUsers(this.state.data.orgnizationTenantData.id,this.context.pageContext).then(e=>{e?this._onUpdateUnresolvedUsers(e):t.captureError("No result returned from getDisconnectedUsers");},e=>{t.captureError(e.message);});},this._onConnectToAad=async(e,t)=>{this.setState({showAadConnectPanel:!1,updateAadInProgress:!0,newOrgTenantName:t});var a=new u.OrganizationAadSource(),s=this._startActionCapture("Connect Organization Tenant",{SelectedTenant:e,CurrentOrg:this.state.data.organizationId,NumberOfDisconnectUsers:this.state.disconnectedUsers.length});await a.updateAadTenant(e,this.context).then(e=>{e?this.setState({updateAadInProgress:!1,showAadConnectSuccessDialog:!0}):(s.captureError("No result returned from updateAadTenant"),this.setState({updateAadInProgress:!1,showAadConnectUnsuccessDialog:!0}));},e=>{s.captureError(e.message),this.setState({updateAadInProgress:!1,showAadConnectUnsuccessDialog:!0,aadConnectError:(0,v.CleanErrorMessage)(e.message)});});},this._onDisconnectToAad=async()=>{this.setState({showAadDisconnectDialog:!1,updateAadInProgress:!0});var e=new u.OrganizationAadSource(),t=this._startActionCapture("Disconnect Organization Tenant",{});await e.updateAadTenant(l.EmptyGuidString,this.context).then(e=>{e?this.setState({updateAadInProgress:!1,showAadDisconnectSuccessDialog:!0}):(t.captureError("No result returned from updateAadTenant"),this.setState({updateAadInProgress:!1,showAadDisconnectUnsuccessDialog:!0}));},e=>{t.captureError(e.message),this.setState({updateAadInProgress:!1,showAadDisconnectUnsuccessDialog:!0,aadDisconnectError:(0,v.CleanErrorMessage)(e.message)});});},this._FetchTenantData=async()=>{const e=this.context.pageContext.getService("IVssContributionService");var t=await e.getDataAsync("ms.vss-admin-web.organization-admin-aad-user-tenants-data-provider"),a=!1;t&&t.userTenantData&&t.userTenantData.userTenants.length>0&&(a=!0),this.setState({userTenantData:t?t.userTenantData:void 0,hasUserTenant:a});};var a=this.context.pageContext.getService("IVssContributionService").getData("ms.vss-admin-web.organization-admin-aad-data-provider");a&&a.orgnizationTenantData&&a.orgnizationTenantData.id&&(this.hasTenantConnected=a.orgnizationTenantData.id!=l.EmptyGuidString),this.isOrgPolicyEnabled=(0,y.isFeatureFlagEnabled)(this.context.pageContext,"VisualStudio.Services.AdminEngagement.OrganizationAzureActiveDirectory.EnableOrganizationPolicy",!1),this.isGlobalPatPolicyEnabled=(0,y.isFeatureFlagEnabled)(this.context.pageContext,"VisualStudio.Services.TenantPolicy.Admin.PATs.RestrictGlobalTokenCreationPolicy",!1),this.isFullScopePatPolicyEnabled=(0,y.isFeatureFlagEnabled)(this.context.pageContext,"VisualStudio.Services.TenantPolicy.Admin.PATs.RestrictFullScopeTokenCreationPolicy",!1),this.isTokenLifespanPolicyEnabled=(0,y.isFeatureFlagEnabled)(this.context.pageContext,"VisualStudio.Services.TenantPolicy.Admin.PATs.RestrictTokenLifespanPolicy",!1),this.isTokenAutoRevocationPolicyEnabled=(0,y.isFeatureFlagEnabled)(this.context.pageContext,"VisualStudio.Services.TenantPolicy.Admin.PATs.EnableLeakedPersonalAccessTokenAutoRevocation",!1),this.isSwitchTenantEnabled=(0,y.isFeatureFlagEnabled)(this.context.pageContext,"VisualStudio.Services.AdminEngagement.OrganizationAzureActiveDirectory.EnableSwitchTenant",!1),this.state={data:a,showAadConnectPanel:!1,updateAadInProgress:!1,showAadDisconnectDialog:!1,showAadDisconnectSuccessDialog:!1,showAadConnectSuccessDialog:!1,showAadConnectUnsuccessDialog:!1,showAadDisconnectUnsuccessDialog:!1,aadConnectError:"",aadDisconnectError:"",newOrgTenantName:"",disconnectedUsers:[],showDisconnectUserDialog:!1,showResolvePanel:!1,showSendInvitePanel:!1,totalOrgUsers:0,showTooManyUsersWarning:!1,showMappingLoadingPanel:!1,showInvitationLoadingPanel:!1,mappingUserInProgress:0,numberOfSuccessfulMappedUser:0,numberOfUnsuccessfulMappedUser:0,numberOfSuccessfulInvitedUser:0,numberOfUnsuccessfulInvitedUser:0,userResolveActionDone:!1,showDisconnectedUserWarning:!1,failureMappingUsers:[],failureMappingUsersCustomModel:[],showFailureMappedUsersDialog:!1,showFailureInvitingUsersDialog:!1,hasUserTenant:!1,isDownloadInProgress:!1,showDownloadErrorMessageBar:!1,downloadErrorMessage:"",showOrgCreationAddAadGroupPanel:!1,showGlobalPatAddAadGroupPanel:!1,showFullScopePatAddAadGroupPanel:!1,showTokenLifespanAddAadGroupPanel:!1,showEditErrorMessagePanel:!1,isOrgPolicyUpdateInProgress:!1,isGlobalPatPolicyUpdateInProgress:!1,isFullScopePatPolicyUpdateInProgress:!1,isTokenLifespanPolicyUpdateInProgress:!1,isTokenAutoRevocationPolicyUpdateInProgress:!1,showOrgCreationPolicyErrorMessageBar:!1,showGlobalPatPolicyErrorMessageBar:!1,showFullScopePatPolicyErrorMessageBar:!1,showTokenLifespanPolicyErrorMessageBar:!1,showTokenAutoRevocationPolicyErrorMessageBar:!1,orgCreationPolicyErrorMessage:"",globalPatPolicyErrorMessage:"",fullScopePatPolicyErrorMessage:"",tokenLifespanPolicyErrorMessage:"",tokenAutoRevocationPolicyErrorMessage:"",tokenLifespanPendingMaxLifespanDays:30..toString()},!0===this.hasTenantConnected&&!0===this.state.data.hasModifyPermissions&&this._onGetUnresolveUsers();}render(){return a.createElement("div",{className:"left-margin organization-aad-main-div"},a.createElement("h2",{className:"fontSizeL fontWeightSemiBold title-l"},b.OrganizationAadHeading),!1===this.state.hasUserTenant&&!1===this.hasTenantConnected?this._renderNoUserTenantInfoMessage():null,!0===this.state.userResolveActionDone&&0==this.state.disconnectedUsers.length&&(this.state.numberOfSuccessfulInvitedUser>0||this.state.numberOfSuccessfulMappedUser>0)?this._renderUserResolveActionSuccessMessageBar():null,!0===this.state.userResolveActionDone&&this.state.numberOfUnsuccessfulInvitedUser>0?this._renderUserResolveActionFailureMessageBar():null,!0===this.hasTenantConnected&&!0===this.state.showDisconnectedUserWarning?this._renderUnresolvedUserWarning():null,!0===this.state.showDownloadErrorMessageBar?this._renderDownloadErrorMessage():null,this._renderAadConnectContent(),this.state.updateAadInProgress?a.createElement("div",{className:"aad-overlay flex-column flex-center justify-center"},a.createElement(m.Spinner,{size:"large"})):null,this.state.isDownloadInProgress?a.createElement("div",{className:"aad-overlay flex-column flex-center justify-center"},a.createElement(m.Spinner,{size:"large",label:(0,l.format)(b.DownloadSpinnerMessage,this.state.data.orgnizationTenantData.displayName)})):null,this.state.showAadConnectPanel&&this.state.userTenantData?a.createElement(o.WrappedComponent,{dependencies:["ms.vss-admin-web.admin-organization-aad-controls"],wrappedType:"ms.vss-admin-web.aad-connect-panel",wrappedProps:{pageContext:this.context.pageContext,orgTenantData:this.state.data.orgnizationTenantData,userData:this.state.data.user,userTenantData:this.state.userTenantData,onDismiss:this._dismissAadConnectPanel,hasTenantConnected:this.hasTenantConnected,onConnect:this._onConnectToAad,organizationId:this.state.data.organizationId,organizationName:this.state.data.organizationName,onUpdateUnresolvedUsers:this._onUpdateUnresolvedUsers,onOpenDisconnectUserDialog:this._onOpenDisconnectUserDialog}}):null,this.state.showResolvePanel?a.createElement(o.WrappedComponent,{dependencies:["ms.vss-admin-web.admin-organization-aad-controls"],wrappedType:"ms.vss-admin-web.aad-resolve-panel",wrappedProps:{pageContext:this.context.pageContext,orgTenantData:this.state.data.orgnizationTenantData,organizationName:this.state.data.organizationName,disconnectUsers:this.state.disconnectedUsers,isAadGuestUser:this.state.data.user.isGuestUserInAad,onMapIdentities:this._onMapIdentities,onDismiss:this._dismissResolvePanel}}):null,this.state.showSendInvitePanel?a.createElement(o.WrappedComponent,{dependencies:["ms.vss-admin-web.admin-organization-aad-controls"],wrappedType:"ms.vss-admin-web.aad-send-invite-panel",wrappedProps:{pageContext:this.context.pageContext,orgTenantData:this.state.data.orgnizationTenantData,disconnectedUsers:this.state.disconnectedUsers,totalOrgUsers:this.state.totalOrgUsers,numberOfSuccessMappedUsers:this.state.numberOfSuccessfulMappedUser,numberOfUnsuccessMappedUsers:this.state.numberOfUnsuccessfulMappedUser,onSendInvite:this._onSendInvite,onDismiss:this._dismissSendInvitePanel,onOpenFailureMappingUserDialog:this._onOpenFailureMappingUserDialog}}):null,this.state.showMappingLoadingPanel?a.createElement(o.WrappedComponent,{dependencies:["ms.vss-admin-web.admin-organization-aad-controls"],wrappedType:"ms.vss-admin-web.aad-resolve-loading-panel",wrappedProps:{loadingMessage:(0,l.format)(b.MappingLoadingMessage,this.state.mappingUserInProgress,this.state.data.orgnizationTenantData.displayName)}}):null,this.state.showInvitationLoadingPanel?a.createElement(o.WrappedComponent,{dependencies:["ms.vss-admin-web.admin-organization-aad-controls"],wrappedType:"ms.vss-admin-web.aad-resolve-loading-panel",wrappedProps:{loadingMessage:(0,l.format)(b.InviteLoadingMessage,this.state.disconnectedUsers.length,this.state.data.orgnizationTenantData.displayName)}}):null,this.state.showAadDisconnectDialog?a.createElement(o.WrappedComponent,{dependencies:["ms.vss-admin-web.admin-organization-aad-controls"],wrappedType:"ms.vss-admin-web.aad-disconnect-dialog",wrappedProps:{pageContext:this.context.pageContext,orgTenantData:this.state.data.orgnizationTenantData,organizationName:this.state.data.organizationName,onDismiss:this._dismissAadDisconnectPanel,onDisonnect:this._onDisconnectToAad}}):null,this.state.showAadDisconnectSuccessDialog?a.createElement(o.WrappedComponent,{dependencies:["ms.vss-admin-web.admin-organization-aad-controls"],wrappedType:"ms.vss-admin-web.aad-action-success-dialog",wrappedProps:{orgName:this.state.data.organizationName,isConnectAction:!1,onCloseAndSignout:this._onCloseAndSignout,orgTenantName:this.state.data.orgnizationTenantData.displayName,onOpenDisconnectUserDialog:this._onOpenDisconnectUserDialog,showTooManyUsersWarning:this.state.showTooManyUsersWarning}}):null,this.state.showAadConnectSuccessDialog?a.createElement(o.WrappedComponent,{dependencies:["ms.vss-admin-web.admin-organization-aad-controls"],wrappedType:"ms.vss-admin-web.aad-action-success-dialog",wrappedProps:{orgName:this.state.data.organizationName,isConnectAction:!0,onCloseAndSignout:this._onCloseAndSignout,orgTenantName:this.state.newOrgTenantName,onOpenDisconnectUserDialog:this._onOpenDisconnectUserDialog,countOfUnresolvedUsers:this.state.disconnectedUsers.length,showTooManyUsersWarning:this.state.showTooManyUsersWarning}}):null,this.state.showAadConnectUnsuccessDialog?a.createElement(o.WrappedComponent,{dependencies:["ms.vss-admin-web.admin-organization-aad-controls"],wrappedType:"ms.vss-admin-web.aad-action-unsuccess-dialog",wrappedProps:{orgName:this.state.data.organizationName,isConnectAction:!0,onClose:this._onCloseUnsuccessAction,error:this.state.aadConnectError,orgTenantName:this.state.newOrgTenantName}}):null,this.state.showAadDisconnectUnsuccessDialog?a.createElement(o.WrappedComponent,{dependencies:["ms.vss-admin-web.admin-organization-aad-controls"],wrappedType:"ms.vss-admin-web.aad-action-unsuccess-dialog",wrappedProps:{orgName:this.state.data.organizationName,isConnectAction:!1,onClose:this._onCloseUnsuccessAction,error:this.state.aadDisconnectError,orgTenantName:this.state.data.orgnizationTenantData.displayName}}):null,!0===this.state.showDisconnectUserDialog?a.createElement(o.WrappedComponent,{dependencies:["ms.vss-admin-web.admin-common"],wrappedType:"ms.vss-admin-web.users-list-dialog",wrappedProps:{users:this.state.disconnectedUsers,onClose:()=>(this._onCloseDisconnectUserDialog()),title:b.DisconnectedUsersDialogTitle,pageContext:this.context.pageContext}}):null,!0===this.state.showFailureMappedUsersDialog?a.createElement(o.WrappedComponent,{wrappedType:"ms.vss-admin-web.multi-operation-dialog",dependencies:["ms.vss-admin-web.admin-common-controls-content"],wrappedProps:{title:b.AadMappingUserErrorDialogTitlte,statusText:b.AadMappingUserErrorDialogTitlte,primaryColumnHeading:b.MappedUserColumn,secondaryColumnHeading:b.IncorrectMappingColumn,onCancel:this._onCloseFailureMappingUsersDialog,operations:this.state.failureMappingUsersCustomModel}}):null,!0===this.state.showFailureInvitingUsersDialog?a.createElement(o.WrappedComponent,{dependencies:["ms.vss-admin-web.admin-common"],wrappedType:"ms.vss-admin-web.users-list-dialog",wrappedProps:{users:this.state.disconnectedUsers,onClose:()=>(this._onCloseFailureInvitingUsersDialog()),title:b.DisconnectedUsersDialogTitle,pageContext:this.context.pageContext}}):null,!0===this.state.showOrgCreationAddAadGroupPanel?a.createElement(o.WrappedComponent,{dependencies:["ms.vss-admin-web.admin-organization-aad-policy-controls"],wrappedType:"ms.vss-admin-web.aad-policy-add-group-panel",wrappedProps:{pageContext:this.context.pageContext,onDismiss:()=>{this.setState({showOrgCreationAddAadGroupPanel:!1});},onAddAadGroups:e=>{this.setState({showOrgCreationAddAadGroupPanel:!1}),this._onAddAadGroupsOrUsers(e,this.state.orgPolicyData);}}}):null,!0===this.state.showGlobalPatAddAadGroupPanel?a.createElement(o.WrappedComponent,{dependencies:["ms.vss-admin-web.admin-organization-aad-policy-controls"],wrappedType:"ms.vss-admin-web.aad-policy-add-group-panel",wrappedProps:{pageContext:this.context.pageContext,onDismiss:()=>{this.setState({showGlobalPatAddAadGroupPanel:!1,currentPolicyData:void 0});},onAddAadGroups:e=>{this._onAddAadGroupsOrUsers(e,this.state.currentPolicyData),this.setState({showGlobalPatAddAadGroupPanel:!1,currentPolicyData:void 0});}}}):null,!0===this.state.showEditErrorMessagePanel?a.createElement(o.WrappedComponent,{dependencies:["ms.vss-admin-web.admin-organization-aad-policy-controls"],wrappedType:"ms.vss-admin-web.aad-policy-error-message-panel",wrappedProps:{pageContext:this.context.pageContext,displayErrorMessage:this.state.orgPolicyData&&this.state.orgPolicyData.properties&&__WRAPPED_get(this.state.orgPolicyData.properties,D.PolicyProperties.ErrorMessage)?__WRAPPED_get(this.state.orgPolicyData.properties,D.PolicyProperties.ErrorMessage):b.DefaultOrgCreationErrorMessage,onDismiss:()=>{this.setState({showEditErrorMessagePanel:!1});},onUpdateErrorMessage:this._onUpdateErrorMessage}}):null,!0===this.state.showFullScopePatAddAadGroupPanel?a.createElement(o.WrappedComponent,{dependencies:["ms.vss-admin-web.admin-organization-aad-policy-controls"],wrappedType:"ms.vss-admin-web.aad-policy-add-group-panel",wrappedProps:{pageContext:this.context.pageContext,onDismiss:()=>{this.setState({showFullScopePatAddAadGroupPanel:!1,currentPolicyData:void 0});},onAddAadGroups:e=>{this._onAddAadGroupsOrUsers(e,this.state.currentPolicyData),this.setState({showFullScopePatAddAadGroupPanel:!1,currentPolicyData:void 0});}}}):null,!0===this.state.showTokenLifespanAddAadGroupPanel?a.createElement(o.WrappedComponent,{dependencies:["ms.vss-admin-web.admin-organization-aad-policy-controls"],wrappedType:"ms.vss-admin-web.aad-policy-add-group-panel",wrappedProps:{pageContext:this.context.pageContext,onDismiss:()=>{this.setState({showTokenLifespanAddAadGroupPanel:!1,currentPolicyData:void 0});},onAddAadGroups:e=>{this._onAddAadGroupsOrUsers(e,this.state.currentPolicyData),this.setState({showTokenLifespanAddAadGroupPanel:!1,currentPolicyData:void 0});}}}):null);}_renderDownloadErrorMessage(){return a.createElement("div",{className:"width-100 message-bar-div"},a.createElement(p.MessageBar,{severity:"Error"},a.createElement("span",{className:"text-word-break"},this.state.downloadErrorMessage)));}_renderNoUserTenantInfoMessage(){return this.state.userTenantData?a.createElement("div",{className:"width-100 message-bar-div no-user-tenant-div"},a.createElement(p.MessageBar,{severity:"Info"},a.createElement("span",{className:"text-word-break"},b.AadMainPageUserNoTenant))):a.createElement(m.Spinner,{label:b.FetchingTenants,className:"flex-grow justify-center"},b.FetchingTenants);}_renderUserResolveActionSuccessMessageBar(){return this.state.numberOfSuccessfulInvitedUser>0&&this.state.numberOfSuccessfulMappedUser>0?a.createElement("div",{className:"width-100 message-bar-div user-resolve-action-success-div"},a.createElement(p.MessageBar,{severity:"Success"},a.createElement("span",{className:"text-word-break"},(0,l.format)(b.UserResolveActionSuccessMessage,this.state.numberOfSuccessfulMappedUser,this.state.numberOfSuccessfulInvitedUser,this.state.data.orgnizationTenantData.displayName)))):this.state.numberOfSuccessfulMappedUser>0?a.createElement("div",{className:"width-100 message-bar-div user-resolve-action-success-div"},a.createElement(p.MessageBar,{severity:"Success"},a.createElement("span",{className:"text-word-break"},(0,l.format)(b.UserMappingSuccessMessage,this.state.numberOfSuccessfulMappedUser)))):a.createElement("div",{className:"width-100 message-bar-div user-resolve-action-success-div"},a.createElement(p.MessageBar,{severity:"Success"},a.createElement("span",{className:"text-word-break"},(0,l.format)(b.UserInviteSuccessMessage,this.state.numberOfSuccessfulInvitedUser,this.state.data.orgnizationTenantData.displayName))));}_renderUserResolveActionFailureMessageBar(){return a.createElement("div",{className:"user-action-failure-div width-100 message-bar-div"},a.createElement(p.MessageBar,{severity:"Warning",buttonProps:[{className:"primary-action-button unresolve-message-button",onClick:this._openResolvePanel,primary:!0,text:b.Resolve}]},a.createElement("div",{className:"block-display"},a.createElement(A.FormatComponent,{format:b.UserInviteActionFailureMessage},a.createElement(c.Link,{className:"cursor-pointer",onClick:this._onOpenFailureInvitingUsersDialog},a.createElement("span",{className:"text-word-break",dangerouslySetInnerHTML:(0,P.createMarkup)((0,l.format)(b.UserInviteActionFailureLink,this.state.numberOfUnsuccessfulInvitedUser))})),a.createElement(c.Link,{href:b.AadConnectLearnMoreUrl,target:"_blank"},b.UserResolveReviewDocumentation)))));}_renderUnresolvedUserWarning(){return a.createElement("div",{className:"top-margin unresolve-message width-100 message-bar-div"},a.createElement(p.MessageBar,{severity:"Warning",buttonProps:[{className:"primary-action-button unresolve-message-button",onClick:this._openResolvePanel,primary:!0,text:b.Resolve}]},a.createElement("div",{className:"block-display"},a.createElement("span",null,a.createElement(c.Link,{className:"cursor-pointer",onClick:this._onOpenDisconnectUserDialog},a.createElement("span",{className:"text-word-break",dangerouslySetInnerHTML:(0,P.createMarkup)((0,l.format)(b.AadConnectSuccessLink,this.state.disconnectedUsers.length))}))),a.createElement("span",{className:"text-word-break",dangerouslySetInnerHTML:(0,P.createMarkup)((0,l.format)(b.AadConnectedBannerDescription,(0,h.filterXSS)(this.state.data.organizationName),(0,h.filterXSS)(this.state.data.orgnizationTenantData.displayName)))}),a.createElement("span",{className:"text-word-break",dangerouslySetInnerHTML:(0,P.createMarkup)((0,l.format)(b.AadConnectedBannerUnableToLogin,(0,h.filterXSS)(this.state.data.orgnizationTenantData.displayName)))}),a.createElement("span",{className:"text-word-break",dangerouslySetInnerHTML:(0,P.createMarkup)(b.AadConnectedDeleteUsers)}))));}_renderAadConnectContent(){return!1===this.hasTenantConnected?a.createElement("div",{className:"top-margin bottom-margin no-org-tenant-connect-div"},a.createElement("div",{className:"fontSizeM overview-heading"},b.AadConnectDescription),a.createElement("div",{className:"top-margin"},a.createElement(c.Link,{className:"cursor-pointer",href:b.AadConnectLearnMoreUrl,target:"_blank"},b.AadConnectLearnMore)),a.createElement("div",{className:"top-margin"},a.createElement(i.Button,{text:b.AadConnectButton,onClick:()=>{this._openAadConnectPanel(!1);},disabled:!this.state.data.hasModifyPermissions||!this.state.hasUserTenant,primary:!0}))):a.createElement("div",{className:"top-margin bottom-margin org-tenant-connect-div"},a.createElement("div",{className:"fontSizeM overview-heading"},a.createElement("span",{dangerouslySetInnerHTML:(0,P.createMarkup)((0,l.format)(b.AadConnectedDescription,(0,h.filterXSS)(this.state.data.orgnizationTenantData.displayName)))})),a.createElement("div",{className:"flex-row flex-center small-top-margin tenant-aad-info-div"},a.createElement("div",{className:"aad-logo-div"},a.createElement(r.Icon,{iconName:"AzureLogo",className:"aad-icon"})),a.createElement("div",null,a.createElement("div",{className:"small-top-margin fontWeightSemiBold"},this.state.data.orgnizationTenantData.displayName),a.createElement("div",{className:"small-top-margin"},this.state.data.orgnizationTenantData.domain),a.createElement("div",{className:"small-top-margin"},(0,l.format)(b.TenantId,this.state.data.orgnizationTenantData.id)))),this.isSwitchTenantEnabled?null:a.createElement("div",{className:"top-margin"},a.createElement(A.FormatComponent,{format:b.AadConnectedLearnHowTo},a.createElement(c.Link,{className:"cursor-pointer",href:b.AadConnectedLearnHowToSwitchTenantLink,target:"_blank"},b.AadConnectedLearnHowToSwitchTenant))),a.createElement("div",{className:"top-margin"},a.createElement(A.FormatComponent,{format:b.AadConnectedLearnCheckOut},a.createElement(c.Link,{className:"cursor-pointer",href:b.AadConnectedLearnHowToFaqLink,target:"_blank"},b.AadConnectedLearnFaq))),a.createElement("div",{className:"top-margin"},a.createElement(i.Button,{text:b.AadDisconnectButton,onClick:this._openAadDisconnectPanel,disabled:!this.state.data.hasModifyPermissions,primary:!0}),this.state.userTenantData&&this.state.userTenantData.userTenants.length>1&&this.isSwitchTenantEnabled?a.createElement(i.Button,{className:"small-left-margin",text:b.AadSwitchButton,onClick:()=>{this._openAadConnectPanel(!0);},disabled:!this.state.data.hasModifyPermissions}):null),this.state.data.isMicrosoftTenant?null:this._renderDownloadConnectedOrgs(),!0===this.isOrgPolicyEnabled&&this.state.orgPolicyData&&this._renderOrgPolicyContent(),!0===this.isGlobalPatPolicyEnabled&&this.state.globalPatPolicyData&&this._renderGlobalPatPolicyContent(),!0===this.isFullScopePatPolicyEnabled&&this.state.fullScopePatPolicyData&&this._renderFullScopePatPolicyContent(),!0===this.isTokenLifespanPolicyEnabled&&this.state.tokenLifespanPolicyData&&this._renderTokenLifespanPolicyContent(),!0===this.isTokenAutoRevocationPolicyEnabled&&this.state.tokenAutoRevocationPolicyData&&this._renderTokenAutoRevocationPolicyContent());}_renderPolicyNotice(){return a.createElement("div",{className:"grey-font"},a.createElement(A.FormatComponent,{format:b.PolicyAllowListDescriptionNotice},a.createElement(c.Link,{className:"cursor-pointer",href:b.PolicyAllowListDescriptionNoticeLink,target:"_blank"},b.PolicyAllowListDescriptionNoticeHere)));}_renderOrgPolicyContent(){return a.createElement("div",{className:"org-policy-content-div"},a.createElement("div",{className:"overview-divider"}),a.createElement("div",{className:"big-top-margin fontSizeL fontWeightSemiBold"},b.AadPoliciesTitle),!0===this.state.showOrgCreationPolicyErrorMessageBar&&a.createElement("div",{className:"width-100 message-bar-div small-top-margin"},a.createElement(p.MessageBar,{severity:"Error"},a.createElement("span",{className:"text-word-break"},this.state.orgCreationPolicyErrorMessage))),a.createElement("div",{className:"top-margin tenant-policy-div"},a.createElement("div",{className:"tenant-policy-title fontWeightSemiBold flex-row flex-center flex-align-start"},a.createElement("div",null,b.OrgCreationPolicyTitle),a.createElement("div",{className:"tenant-policy-toggle"},a.createElement(E.Toggle,{checked:this.orgPolicyToggleEnabled,onChange:(e,t)=>(this._onPolicyToggleChange(this.state.orgPolicyData,e,t)),ariaLabel:b.OrgCreationPolicyTitle})),!0===this.state.isOrgPolicyUpdateInProgress&&a.createElement("div",{className:"update-tenant-policy-spinner"},a.createElement(m.Spinner,{size:"small"}))),a.createElement("div",{className:"grey-font"},(0,l.format)(b.OrgCreationPolicyDescription,this.state.data.orgnizationTenantData.displayName)),a.createElement("div",{className:"top-margin"},a.createElement("div",{className:"fontSizeM fontWeightSemiBold"},b.OrgCreationPolicyAllowList),a.createElement("div",{className:"grey-font"},b.OrgCreationPolicyAllowListDescription),this._renderPolicyNotice()),this.state.orgPolicyData&&this.state.orgPolicyData.properties&&__WRAPPED_get(this.state.orgPolicyData.properties,D.PolicyProperties.AllowedUsersAndGroupObjectIds)&&this._renderAadGroups(this.state.orgPolicyData,this.orgPolicyToggleEnabled),a.createElement("div",{className:"top-margin"},a.createElement(i.Button,{text:b.OrgCreationPolicyAddGroupButton,onClick:()=>{this._startActionCapture("Show Org CreationAdd AAD Group Panel",{}),this.setState({showOrgCreationAddAadGroupPanel:!0});},disabled:!this.orgPolicyToggleEnabled.value,primary:!0})),a.createElement("div",{className:"top-margin"},a.createElement("div",{className:"fontSizeM fontWeightSemiBold"},b.OrgCreationPolicyErrorMessageTitle),a.createElement("div",{className:"grey-font org-policy-display-error-message"},this.state.orgPolicyData&&this.state.orgPolicyData.properties&&__WRAPPED_get(this.state.orgPolicyData.properties,D.PolicyProperties.ErrorMessage)?__WRAPPED_get(this.state.orgPolicyData.properties,D.PolicyProperties.ErrorMessage):b.DefaultOrgCreationErrorMessage)),a.createElement("div",{className:"top-margin"},a.createElement(i.Button,{text:b.OrgCreationPolicyErrorMessageButton,onClick:()=>{this._startActionCapture("Show Edit Error Message Panel",{}),this.setState({showEditErrorMessagePanel:!0});},disabled:!this.orgPolicyToggleEnabled.value,primary:!0}))));}_renderGlobalPatPolicyContent(){return a.createElement("div",{className:"global-pat-policy-content-div"},a.createElement("div",{className:"overview-divider"}),!0===this.state.showGlobalPatPolicyErrorMessageBar&&a.createElement("div",{className:"width-100 message-bar-div small-top-margin"},a.createElement(p.MessageBar,{severity:"Error"},a.createElement("span",{className:"text-word-break"},this.state.globalPatPolicyErrorMessage))),a.createElement("div",{className:"top-margin tenant-policy-div"},a.createElement("div",{className:"tenant-policy-title fontWeightSemiBold flex-row flex-center flex-align-start"},a.createElement("div",null,b.GlobalPatCreationPolicyTitle),a.createElement("div",{className:"tenant-policy-toggle"},a.createElement(E.Toggle,{checked:this.globalPatPolicyToggleEnabled,onChange:(e,t)=>(this._onPolicyToggleChange(this.state.globalPatPolicyData,e,t)),ariaLabel:b.GlobalPatCreationPolicyTitle})),!0===this.state.isGlobalPatPolicyUpdateInProgress&&a.createElement("div",{className:"update-tenant-policy-spinner"},a.createElement(m.Spinner,{size:"small"}))),a.createElement("div",{className:"grey-font"},a.createElement("div",null,b.GlobalPatCreationPolicyDescription)),a.createElement("div",{className:"top-margin"},a.createElement("div",{className:"fontSizeM fontWeightSemiBold"},b.PatCreationPolicyAllowList),a.createElement("div",{className:"grey-font"},(0,l.format)(b.PatCreationPolicyAllowListDescription,b.GlobalPat,"")),this._renderPolicyNotice()),this.state.globalPatPolicyData&&this.state.globalPatPolicyData.properties&&__WRAPPED_get(this.state.globalPatPolicyData.properties,D.PolicyProperties.AllowedUsersAndGroupObjectIds)&&this._renderAadGroups(this.state.globalPatPolicyData,this.globalPatPolicyToggleEnabled),a.createElement("div",{className:"top-margin"},a.createElement(i.Button,{text:b.PatCreationPolicyAddGroupButton,onClick:()=>{this._startActionCapture("Show Global PAT Add AAD Group Panel",{}),this.setState({showGlobalPatAddAadGroupPanel:!0,currentPolicyData:this.state.globalPatPolicyData});},disabled:!this.globalPatPolicyToggleEnabled.value,primary:!0}))));}_renderFullScopePatPolicyContent(){return a.createElement("div",{className:"full-scope-pat-policy-content-div"},a.createElement("div",{className:"overview-divider"}),!0===this.state.showFullScopePatPolicyErrorMessageBar&&a.createElement("div",{className:"width-100 message-bar-div small-top-margin"},a.createElement(p.MessageBar,{severity:"Error"},a.createElement("span",{className:"text-word-break"},this.state.fullScopePatPolicyErrorMessage))),a.createElement("div",{className:"top-margin tenant-policy-div"},a.createElement("div",{className:"tenant-policy-title fontWeightSemiBold flex-row flex-center flex-align-start"},a.createElement("div",null,b.FullScopePatCreationPolicyTitle),a.createElement("div",{className:"tenant-policy-toggle"},a.createElement(E.Toggle,{checked:this.fullScopePatPolicyToggleEnabled,onChange:(e,t)=>(this._onPolicyToggleChange(this.state.fullScopePatPolicyData,e,t)),ariaLabel:b.FullScopePatCreationPolicyTitle})),!0===this.state.isFullScopePatPolicyUpdateInProgress&&a.createElement("div",{className:"update-tenant-policy-spinner"},a.createElement(m.Spinner,{size:"small"}))),a.createElement("div",{className:"grey-font"},a.createElement("div",null,b.FullScopePatCreationPolicyDescription)),a.createElement("div",{className:"top-margin"},a.createElement("div",{className:"fontSizeM fontWeightSemiBold"},b.PatCreationPolicyAllowList),a.createElement("div",{className:"grey-font"},(0,l.format)(b.PatCreationPolicyAllowListDescription,b.FullScopedPat,"")),this._renderPolicyNotice()),this.state.fullScopePatPolicyData&&this.state.fullScopePatPolicyData.properties&&__WRAPPED_get(this.state.fullScopePatPolicyData.properties,D.PolicyProperties.AllowedUsersAndGroupObjectIds)&&this._renderAadGroups(this.state.fullScopePatPolicyData,this.fullScopePatPolicyToggleEnabled),a.createElement("div",{className:"top-margin"},a.createElement(i.Button,{text:b.PatCreationPolicyAddGroupButton,onClick:()=>{this._startActionCapture("Show Full-scoped PAT Add AAD Group Panel",{}),this.setState({showFullScopePatAddAadGroupPanel:!0,currentPolicyData:this.state.fullScopePatPolicyData});},disabled:!this.fullScopePatPolicyToggleEnabled.value,primary:!0}))));}_renderTokenLifespanPolicyContent(){return a.createElement("div",{className:"token-lifespan-policy-content-div"},a.createElement("div",{className:"overview-divider"}),!0===this.state.showTokenLifespanPolicyErrorMessageBar&&a.createElement("div",{className:"width-100 message-bar-div small-top-margin"},a.createElement(p.MessageBar,{severity:"Error"},a.createElement("span",{className:"text-word-break"},this.state.tokenLifespanPolicyErrorMessage))),a.createElement("div",{className:"top-margin tenant-policy-div"},a.createElement("div",{className:"tenant-policy-title fontWeightSemiBold flex-row flex-center flex-align-start"},a.createElement("div",null,b.EnforceTokenLifespanPolicyTitle),a.createElement("div",{className:"tenant-policy-toggle"},a.createElement(E.Toggle,{checked:this.tokenLifespanPolicyToggleEnabled,onChange:(e,t)=>(this._onPolicyToggleChange(this.state.tokenLifespanPolicyData,e,t)),ariaLabel:b.EnforceTokenLifespanPolicyTitle})),!0===this.state.isTokenLifespanPolicyUpdateInProgress&&a.createElement("div",{className:"update-tenant-policy-spinner"},a.createElement(m.Spinner,{size:"small"}))),a.createElement("div",{className:"grey-font"},a.createElement("div",null,b.EnforceTokenLifespanPolicyDescription)),a.createElement("div",{className:"top-margin"},a.createElement("div",{className:"fontSizeM fontWeightSemiBold"},b.EnforceTokenLifespanPolicyMaxLifespanDays)),a.createElement("div",{className:"top-margin tenant-policy-text-input"},a.createElement(d.TextField,{className:"tenant-policy-text-box",onChange:(e,t)=>(this._onUpdatePendingMaxLifespanDays(e,t,this.state.tokenLifespanPolicyData)),disabled:!this.tokenLifespanPolicyToggleEnabled.value,value:this.state.tokenLifespanPendingMaxLifespanDays.toString(),ariaLabel:b.EnforceTokenLifespanPolicyMaxLifespanDays}),a.createElement(i.Button,{text:b.EnforceTokenLifespanPolicyMaxLifespanDaysButton,onClick:()=>(this._onSaveMaxLifespanDays(this.state.tokenLifespanPolicyData)),disabled:!this.tokenLifespanPolicyToggleEnabled.value||this.state.showTokenLifespanPolicyErrorMessageBar,primary:!0})),a.createElement("div",{className:"top-margin"},a.createElement("div",{className:"fontSizeM fontWeightSemiBold"},b.PatCreationPolicyAllowList),a.createElement("div",{className:"grey-font"},(0,l.format)(b.PatCreationPolicyAllowListDescription,"",b.PatLifespan)),this._renderPolicyNotice()),this.state.tokenLifespanPolicyData&&this.state.tokenLifespanPolicyData.properties&&__WRAPPED_get(this.state.tokenLifespanPolicyData.properties,D.PolicyProperties.AllowedUsersAndGroupObjectIds)&&this._renderAadGroups(this.state.tokenLifespanPolicyData,this.tokenLifespanPolicyToggleEnabled),a.createElement("div",{className:"top-margin"},a.createElement(i.Button,{text:b.PatCreationPolicyAddGroupButton,onClick:()=>{this._startActionCapture("Show PAT lifespan Add AAD Group Panel",{}),this.setState({showTokenLifespanAddAadGroupPanel:!0,currentPolicyData:this.state.tokenLifespanPolicyData});},disabled:!this.tokenLifespanPolicyToggleEnabled.value,primary:!0}))));}_renderTokenAutoRevocationPolicyContent(){return a.createElement("div",{className:"token-auto-revocation-policy-content-div"},a.createElement("div",{className:"overview-divider"}),!0===this.state.showTokenAutoRevocationPolicyErrorMessageBar&&a.createElement("div",{className:"width-100 message-bar-div small-top-margin"},a.createElement(p.MessageBar,{severity:"Error"},a.createElement("span",{className:"text-word-break"},this.state.tokenAutoRevocationPolicyErrorMessage))),a.createElement("div",{className:"top-margin tenant-policy-div"},a.createElement("div",{className:"tenant-policy-title fontWeightSemiBold flex-row flex-center flex-align-start"},a.createElement("div",null,b.EnableTokenAutoRevocationPolicyTitle),a.createElement("div",{className:"tenant-policy-toggle"},a.createElement(E.Toggle,{checked:this.tokenAutoRevocationPolicyToggleEnabled.value,onChange:(e,t)=>(this._onPolicyToggleChange(this.state.tokenAutoRevocationPolicyData,e,t)),ariaLabel:b.EnableTokenAutoRevocationPolicyTitle})),!0===this.state.isTokenAutoRevocationPolicyUpdateInProgress&&a.createElement("div",{className:"update-tenant-policy-spinner"},a.createElement(m.Spinner,{size:"small"}))),a.createElement("div",{className:"grey-font"},a.createElement(A.FormatComponent,{format:b.EnableTokenAutoRevocationPolicyDescription},a.createElement(c.Link,{className:"cursor-pointer",href:b.EnableTokenAutoRevocationPolicyDescriptionLink,target:"_blank"},b.EnableTokenAutoRevocationPolicyDescriptionLearnMore)))));}_renderDownloadConnectedOrgs(){return a.createElement("div",{className:"download-connect-org-div"},a.createElement("div",{className:"overview-divider"}),a.createElement("div",{className:"big-top-margin"},a.createElement("span",{className:"fontSizeM overview-heading",dangerouslySetInnerHTML:(0,P.createMarkup)((0,l.format)(b.DownloadConnectedOrgs,(0,h.filterXSS)(this.state.data.orgnizationTenantData.displayName)))}),a.createElement("div",{className:"top-margin"},a.createElement(i.Button,{text:b.DownloadButton,onClick:this._downloadConnectedOrgs,disabled:this.state.isDownloadInProgress,primary:!0}))));}_renderAadGroups(e,t){return a.createElement("div",{className:"small-top-margin allow-user-group-div"},a.createElement(w.PillGroup,{className:"flex-row"},e&&e.properties&&__WRAPPED_get(e.properties,D.PolicyProperties.AllowedUsersAndGroupObjectIds).map((s,n)=>(a.createElement(C.AadGroupOrUserPillComponent,{orgPolicyToggleEnabled:t.value,identity:s,index:n,onRemove:t=>(this._onRemoveAadGroupOrUser(t,e))})))));}componentDidMount(){super.componentDidMount();this.context.pageContext.getService("IVssPerformanceService").markTimeToInteractive(g.Area.Admin,g.Feature.OrganizationAad),this._FetchTenantData(),this._updateDelayLoad();}async _updateDelayLoad(){var e=this.context.pageContext.getService("IVssContributionService"),t=await e.getDataAsync("ms.vss-admin-web.organization-admin-aad-delay-load-data-provider");t&&(t.orgCreationPolicy?this.orgPolicyToggleEnabled.value=!0===t.orgCreationPolicy.isPolicyEnabled:this.orgPolicyToggleEnabled.value=!1,t.globalTokenPolicy?this.globalPatPolicyToggleEnabled.value=1==t.globalTokenPolicy.isPolicyEnabled:this.globalPatPolicyToggleEnabled.value=!1,t.fullScopeTokenPolicy?this.fullScopePatPolicyToggleEnabled.value=!0===t.fullScopeTokenPolicy.isPolicyEnabled:this.fullScopePatPolicyToggleEnabled.value=!1,t.tokenLifespanPolicy?this.tokenLifespanPolicyToggleEnabled.value=!0===t.tokenLifespanPolicy.isPolicyEnabled:this.tokenLifespanPolicyToggleEnabled.value=!1,t.leakedTokenAutoRevocationPolicy?this.tokenAutoRevocationPolicyToggleEnabled.value=!0===t.leakedTokenAutoRevocationPolicy.isPolicyEnabled:this.tokenAutoRevocationPolicyToggleEnabled.value=!1),this.setState({orgPolicyData:t&&t.orgCreationPolicy?t.orgCreationPolicy:void 0}),this.setState({globalPatPolicyData:t&&t.globalTokenPolicy?t.globalTokenPolicy:void 0}),this.setState({fullScopePatPolicyData:t&&t.fullScopeTokenPolicy?t.fullScopeTokenPolicy:void 0}),this.setState({tokenLifespanPolicyData:t&&t.tokenLifespanPolicy?t.tokenLifespanPolicy:void 0,tokenLifespanPendingMaxLifespanDays:t&&t.tokenLifespanPolicy&&t.tokenLifespanPolicy.properties?__WRAPPED_get(t.tokenLifespanPolicy.properties,D.PolicyProperties.MaxPatLifespanInDays):30..toString()}),this.setState({tokenAutoRevocationPolicyData:t&&t.leakedTokenAutoRevocationPolicy?t.leakedTokenAutoRevocationPolicy:void 0});}_isOrgCreationRestrictionPolicy(e){return null!=e&&"TenantPolicy.OrganizationCreationRestriction"==e.policyName;}_isGlobalPatCreationRestrictionPolicy(e){return null!=e&&"TenantPolicy.RestrictGlobalPersonalAccessToken"==e.policyName;}_isFullScopePatCreationRestrictionPolicy(e){return null!=e&&"TenantPolicy.RestrictFullScopePersonalAccessToken"==e.policyName;}_isEnforcePersonalTokenLifespanPolicy(e){return null!=e&&"TenantPolicy.RestrictPersonalAccessTokenLifespan"==e.policyName;}_isEnableLeakedPersonalAccessTokenAutoRevocationPolicy(e){return null!=e&&"TenantPolicy.EnableLeakedPersonalAccessTokenAutoRevocation"==e.policyName;}}t.OrganizationAad.OrganizationAadComponent=s,o.Components.add("organizationAad",s);}());},["Resources","Components/AadGroupOrUserPill","OrganizationAad"]),document.dispatchEvent(new CustomEvent("scriptLoaded",{cancelable:!1,detail:{id:"ms.vss-admin-web.admin-organization-aad-content"}}));